{
  "cve_id": "CVE-2020-8945",
  "description": "The proglottis Go wrapper before 0.1.1 for the GPGME library has a use-after-free, as demonstrated by use for container image pulls by Docker or CRI-O. This leads to a crash or potential code execution during GPG signature verification.",
  "references": [
    "https://access.redhat.com/errata/RHSA-2020:0679",
    "https://access.redhat.com/errata/RHSA-2020:0689",
    "https://access.redhat.com/errata/RHSA-2020:0697",
    "https://bugzilla.redhat.com/show_bug.cgi?id=1795838",
    "https://github.com/containers/image/commit/4c7a23f82ef09127b0ff28366d1cf31316dd6cc1",
    "https://github.com/proglottis/gpgme/compare/v0.1.0...v0.1.1",
    "https://github.com/proglottis/gpgme/pull/23",
    "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/3SOCLOPTSYABTE4CLTSPDIFE6ZZZR4LX/",
    "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/H6P6SSNKN4H6GSEVROHBDXA64PX7EOED/",
    "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/KDBT77KV3U7BESJX3P4S4MPVDGRTAQA2/",
    "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/WXV7NZELYWRRCXATXU3FYD3G3WJT3WYM/"
  ],
  "commit_urls": [
    "https://github.com/containers/image/commit/4c7a23f82ef09127b0ff28366d1cf31316dd6cc1"
  ],
  "pr_urls": [
    "https://github.com/proglottis/gpgme/pull/23"
  ],
  "issue_urls": [],
  "advisory_urls": [],
  "related_commits": [
    {
      "type": "direct_commit",
      "hash": "4c7a23f82ef09127b0ff28366d1cf31316dd6cc1",
      "url": "https://github.com/containers/image/commit/4c7a23f82ef09127b0ff28366d1cf31316dd6cc1",
      "owner": "containers",
      "repo": "image",
      "message": "Update to github.com/mtrmac/gpgme@v0.1.1\n\nThis primarily includes https://github.com/proglottis/gpgme/pull/23 ,\nfixing use-after-free crashes.\n\nSigned-off-by: Miloslav Trmač <mitr@redhat.com>",
      "author": "Miloslav Trmač",
      "date": "2020-01-18T21:28:49Z"
    },
    {
      "type": "pr_commit",
      "hash": "d43d199046c30db9bef90de20c09843bb8b45737",
      "url": "https://github.com/proglottis/gpgme/commit/d43d199046c30db9bef90de20c09843bb8b45737",
      "pr_url": "https://github.com/proglottis/gpgme/pull/23",
      "pr_number": "23",
      "owner": "proglottis",
      "repo": "gpgme",
      "message": "Ensure Data is not dellocated while C code is still using it\n\nAs far as Go is concerned, Data.dh and Data.cbc are just values, so it is\nOK to implement\n> cgo_call(d.dh)\nas\n> tmp := d.dh\n> dropReferenceTo(d)\n> // d's finalizer can be called at any point from now on, possibly deallocating d.dh\n> cgo_call(tmp) // possibly using free memory\n\nTo fix this, explicitly extend the lifetime of Data:\n> cgo_call(d.dh)\n> runtime.KeepAlive(d)\nbecomes\n> tmp := d.dh\n> cgo_call(tmp) // d.dh is certainly still valid\n> dropReferenceTo(d)\n> // d's finalizer can be called from now on, possibly deallocating d.dh\n\nSigned-off-by: Miloslav Trmač <mitr@redhat.com>",
      "author": "Miloslav Trmač",
      "date": "2020-01-10T15:40:46Z"
    },
    {
      "type": "pr_commit",
      "hash": "7e8c79da5ec1bd810f01f46df83a8a914e49f4fa",
      "url": "https://github.com/proglottis/gpgme/commit/7e8c79da5ec1bd810f01f46df83a8a914e49f4fa",
      "pr_url": "https://github.com/proglottis/gpgme/pull/23",
      "pr_number": "23",
      "owner": "proglottis",
      "repo": "gpgme",
      "message": "Ensure Context is not dellocated while C code is still using it\n\nAs far as Go is concerned, Context.ctx and Context.cbc are just values, so it is\nOK to implement\n> cgo_call(c.ctx)\nas\n> tmp := c.ctx\n> dropReferenceTo(c)\n> // c's finalizer can be called at any point from now on, possibly deallocating c.ctx\n> cgo_call(tmp) // possibly using free memory\n\nTo fix this, explicitly extend the lifetime of Context:\n> cgo_call(c.ctx)\n> runtime.KeepAlive(c)\nbecomes\n> tmp := c.ctx\n> cgo_call(tmp) // c.ctx is certainly still valid\n> dropReferenceTo(c)\n> // c's finalizer can be called from now on, possibly deallocating c.ctx\n\nTo be extra careful, this adds runtime.KeepAlive calls even in cases where the current\ncode path necessarily keeps c alive afterwards, so that the patern is clear and so\nthat future possible changes to the code don't invalidate this assumption.\n\nSecondarily, in a few cases GPGMe returns internal pointers inside Context.ctx;\nin that case, extend the lifetime of Context until we make a complete copy of\nthe data.\n\nAs a special case, EngineInfo is now not just a wrapper around a C pointer with\nan unknown lifetime, but we make a full copy of the data when obtaining the pointer\nso that we can safely use it after dropping the context that returned the information,\nor after changing the information and possibly invalidating the pointers.\n\nSigned-off-by: Miloslav Trmač <mitr@redhat.com>",
      "author": "Miloslav Trmač",
      "date": "2020-01-10T16:26:47Z"
    },
    {
      "type": "pr_commit",
      "hash": "d575e5df6a8359a0ad12f59a8377d362c3eb6afd",
      "url": "https://github.com/proglottis/gpgme/commit/d575e5df6a8359a0ad12f59a8377d362c3eb6afd",
      "pr_url": "https://github.com/proglottis/gpgme/pull/23",
      "pr_number": "23",
      "owner": "proglottis",
      "repo": "gpgme",
      "message": "Ensure Key is not dellocated while C code is still using it\n\nAs far as Go is concerned, Key.k is just a value, so it is\nOK to implement\n> cgo_call(k.k)\nas\n> tmp := k.k\n> dropReferenceTo(k)\n> // k's finalizer can be called at any point from now on, possibly deallocating k.k\n> cgo_call(tmp) // possibly using free memory\n\nTo fix this, explicitly extend the lifetime of Key:\n> cgo_call(k.k)\n> runtime.KeepAlive(k)\nbecomes\n> tmp := k.k\n> cgo_call(tmp) // k.k is certainly still valid\n> dropReferenceTo(k)\n> // k's finalizer can be called from now on, possibly deallocating k.k\n\nSigned-off-by: Miloslav Trmač <mitr@redhat.com>",
      "author": "Miloslav Trmač",
      "date": "2020-01-10T16:50:31Z"
    }
  ],
  "commits": [
    "https://github.com/containers/image/commit/4c7a23f82ef09127b0ff28366d1cf31316dd6cc1",
    {
      "type": "direct_commit",
      "hash": "4c7a23f82ef09127b0ff28366d1cf31316dd6cc1",
      "url": "https://github.com/containers/image/commit/4c7a23f82ef09127b0ff28366d1cf31316dd6cc1",
      "owner": "containers",
      "repo": "image",
      "message": "Update to github.com/mtrmac/gpgme@v0.1.1\n\nThis primarily includes https://github.com/proglottis/gpgme/pull/23 ,\nfixing use-after-free crashes.\n\nSigned-off-by: Miloslav Trmač <mitr@redhat.com>",
      "author": "Miloslav Trmač",
      "date": "2020-01-18T21:28:49Z"
    },
    {
      "type": "pr_commit",
      "hash": "d43d199046c30db9bef90de20c09843bb8b45737",
      "url": "https://github.com/proglottis/gpgme/commit/d43d199046c30db9bef90de20c09843bb8b45737",
      "pr_url": "https://github.com/proglottis/gpgme/pull/23",
      "pr_number": "23",
      "owner": "proglottis",
      "repo": "gpgme",
      "message": "Ensure Data is not dellocated while C code is still using it\n\nAs far as Go is concerned, Data.dh and Data.cbc are just values, so it is\nOK to implement\n> cgo_call(d.dh)\nas\n> tmp := d.dh\n> dropReferenceTo(d)\n> // d's finalizer can be called at any point from now on, possibly deallocating d.dh\n> cgo_call(tmp) // possibly using free memory\n\nTo fix this, explicitly extend the lifetime of Data:\n> cgo_call(d.dh)\n> runtime.KeepAlive(d)\nbecomes\n> tmp := d.dh\n> cgo_call(tmp) // d.dh is certainly still valid\n> dropReferenceTo(d)\n> // d's finalizer can be called from now on, possibly deallocating d.dh\n\nSigned-off-by: Miloslav Trmač <mitr@redhat.com>",
      "author": "Miloslav Trmač",
      "date": "2020-01-10T15:40:46Z"
    },
    {
      "type": "pr_commit",
      "hash": "7e8c79da5ec1bd810f01f46df83a8a914e49f4fa",
      "url": "https://github.com/proglottis/gpgme/commit/7e8c79da5ec1bd810f01f46df83a8a914e49f4fa",
      "pr_url": "https://github.com/proglottis/gpgme/pull/23",
      "pr_number": "23",
      "owner": "proglottis",
      "repo": "gpgme",
      "message": "Ensure Context is not dellocated while C code is still using it\n\nAs far as Go is concerned, Context.ctx and Context.cbc are just values, so it is\nOK to implement\n> cgo_call(c.ctx)\nas\n> tmp := c.ctx\n> dropReferenceTo(c)\n> // c's finalizer can be called at any point from now on, possibly deallocating c.ctx\n> cgo_call(tmp) // possibly using free memory\n\nTo fix this, explicitly extend the lifetime of Context:\n> cgo_call(c.ctx)\n> runtime.KeepAlive(c)\nbecomes\n> tmp := c.ctx\n> cgo_call(tmp) // c.ctx is certainly still valid\n> dropReferenceTo(c)\n> // c's finalizer can be called from now on, possibly deallocating c.ctx\n\nTo be extra careful, this adds runtime.KeepAlive calls even in cases where the current\ncode path necessarily keeps c alive afterwards, so that the patern is clear and so\nthat future possible changes to the code don't invalidate this assumption.\n\nSecondarily, in a few cases GPGMe returns internal pointers inside Context.ctx;\nin that case, extend the lifetime of Context until we make a complete copy of\nthe data.\n\nAs a special case, EngineInfo is now not just a wrapper around a C pointer with\nan unknown lifetime, but we make a full copy of the data when obtaining the pointer\nso that we can safely use it after dropping the context that returned the information,\nor after changing the information and possibly invalidating the pointers.\n\nSigned-off-by: Miloslav Trmač <mitr@redhat.com>",
      "author": "Miloslav Trmač",
      "date": "2020-01-10T16:26:47Z"
    },
    {
      "type": "pr_commit",
      "hash": "d575e5df6a8359a0ad12f59a8377d362c3eb6afd",
      "url": "https://github.com/proglottis/gpgme/commit/d575e5df6a8359a0ad12f59a8377d362c3eb6afd",
      "pr_url": "https://github.com/proglottis/gpgme/pull/23",
      "pr_number": "23",
      "owner": "proglottis",
      "repo": "gpgme",
      "message": "Ensure Key is not dellocated while C code is still using it\n\nAs far as Go is concerned, Key.k is just a value, so it is\nOK to implement\n> cgo_call(k.k)\nas\n> tmp := k.k\n> dropReferenceTo(k)\n> // k's finalizer can be called at any point from now on, possibly deallocating k.k\n> cgo_call(tmp) // possibly using free memory\n\nTo fix this, explicitly extend the lifetime of Key:\n> cgo_call(k.k)\n> runtime.KeepAlive(k)\nbecomes\n> tmp := k.k\n> cgo_call(tmp) // k.k is certainly still valid\n> dropReferenceTo(k)\n> // k's finalizer can be called from now on, possibly deallocating k.k\n\nSigned-off-by: Miloslav Trmač <mitr@redhat.com>",
      "author": "Miloslav Trmač",
      "date": "2020-01-10T16:50:31Z"
    }
  ]
}