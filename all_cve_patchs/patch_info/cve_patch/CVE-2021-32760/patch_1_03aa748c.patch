From 03aa748c11663e87a72fab92b7ab7c88c28bf13e Mon Sep 17 00:00:00 2001
From: Derek McGowan <derek@mcg.dev>
Date: Tue, 6 Jul 2021 12:37:54 -0700
Subject: [PATCH] Use chmod path for checking symlink

Signed-off-by: Derek McGowan <derek@mcg.dev>
(cherry picked from commit 27597ccfd30d8aa06b448062896bccfb33ad8f22)
Signed-off-by: Derek McGowan <derek@mcg.dev>
---
 archive/tar_unix.go | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/archive/tar_unix.go b/archive/tar_unix.go
index 6e89d2fdbc98..c22e79bf2be2 100644
--- a/archive/tar_unix.go
+++ b/archive/tar_unix.go
@@ -113,7 +113,7 @@ func handleTarTypeBlockCharFifo(hdr *tar.Header, path string) error {
 
 func handleLChmod(hdr *tar.Header, path string, hdrInfo os.FileInfo) error {
 	if hdr.Typeflag == tar.TypeLink {
-		if fi, err := os.Lstat(hdr.Linkname); err == nil && (fi.Mode()&os.ModeSymlink == 0) {
+		if fi, err := os.Lstat(path); err == nil && (fi.Mode()&os.ModeSymlink == 0) {
 			if err := os.Chmod(path, hdrInfo.Mode()); err != nil && !os.IsNotExist(err) {
 				return err
 			}
