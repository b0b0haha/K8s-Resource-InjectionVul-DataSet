From b4dc94265fef459865c7a1f2ba1d335815e47b69 Mon Sep 17 00:00:00 2001
From: Michael Crenshaw <350466+crenshaw-dev@users.noreply.github.com>
Date: Tue, 7 Feb 2023 11:01:47 -0500
Subject: [PATCH] simplify

Signed-off-by: Michael Crenshaw <350466+crenshaw-dev@users.noreply.github.com>
---
 .../application/v1alpha1/repository_types.go     |  8 ++++++++
 util/argo/argo.go                                | 16 +---------------
 2 files changed, 9 insertions(+), 15 deletions(-)

diff --git a/pkg/apis/application/v1alpha1/repository_types.go b/pkg/apis/application/v1alpha1/repository_types.go
index aae91703e3aec..2d2eea5e0612a 100644
--- a/pkg/apis/application/v1alpha1/repository_types.go
+++ b/pkg/apis/application/v1alpha1/repository_types.go
@@ -1,6 +1,7 @@
 package v1alpha1
 
 import (
+	"fmt"
 	"net/url"
 
 	"github.com/argoproj/argo-cd/v2/util/cert"
@@ -265,6 +266,13 @@ func (m *Repository) CopySettingsFrom(source *Repository) {
 	}
 }
 
+func (m *Repository) StringForLogging() string {
+	if m == nil {
+		return ""
+	}
+	return fmt.Sprintf("&Repository{Repo: %q, Type: %q, Name: %q, Project: %q}", m.Repo, m.Type, m.Name, m.Project)
+}
+
 // Repositories defines a list of Repository configurations
 type Repositories []*Repository
 
diff --git a/util/argo/argo.go b/util/argo/argo.go
index bfa373d5cc4f4..29738b19abadd 100644
--- a/util/argo/argo.go
+++ b/util/argo/argo.go
@@ -288,8 +288,7 @@ func validateRepo(ctx context.Context,
 			return nil, err
 		}
 		if err := TestRepoWithKnownType(ctx, repoClient, repo, source.IsHelm(), source.IsHelmOci()); err != nil {
-			sanitizedRepo := sanitizeRepoForLogging(repo)
-			errMessage = fmt.Sprintf("repositories not accessible: %v", sanitizedRepo)
+			errMessage = fmt.Sprintf("repositories not accessible: %v", repo.StringForLogging())
 		}
 		repoAccessible := false
 
@@ -339,19 +338,6 @@ func validateRepo(ctx context.Context,
 	return conditions, nil
 }
 
-func sanitizeRepoForLogging(repo *argoappv1.Repository) *argoappv1.Repository {
-	if repo == nil {
-		return nil
-	}
-	sanitizedRepo := &argoappv1.Repository{
-		Repo:    repo.Repo,
-		Type:    repo.Type,
-		Name:    repo.Name,
-		Project: repo.Project,
-	}
-	return sanitizedRepo
-}
-
 // GetRefSources creates a map of ref keys (from the sources' 'ref' fields) to information about the referenced source.
 // This function also validates the references use allowed characters and does not define the same ref key more than
 // once (which would lead to ambiguous references).
