From 8ef76cc0dfa6d909b32310163c32dfe1ce5d2065 Mon Sep 17 00:00:00 2001
From: amdabhad <amdabhad@in.ibm.com>
Date: Fri, 26 Aug 2022 04:26:45 -0700
Subject: [PATCH] Mount fix

- In case of symlink: instead of the symlink, use the target of symlink as the source for bind mount.

Signed-off-by: amdabhad <amdabhad@in.ibm.com>
---
 driver/csiplugin/nodeserver.go | 1 +
 1 file changed, 1 insertion(+)

diff --git a/driver/csiplugin/nodeserver.go b/driver/csiplugin/nodeserver.go
index dfb7762ea..16e53f0a9 100644
--- a/driver/csiplugin/nodeserver.go
+++ b/driver/csiplugin/nodeserver.go
@@ -79,6 +79,7 @@ func (ns *ScaleNodeServer) NodePublishVolume(ctx context.Context, req *csi.NodeP
 			return nil, fmt.Errorf("NodePublishVolume: failed to get symlink target for [%s]. Error [%v]", volScalePathInContainer, readlinkErr)
 		}
 		volScalePathInContainer = hostDir + symlinkTarget
+		volScalePath = symlinkTarget
 		glog.V(4).Infof("NodePublishVolume: symlink tarrget path is [%s]\n", volScalePathInContainer)
 	}
 	args := []string{"-f", "-c", "%T", volScalePathInContainer}
