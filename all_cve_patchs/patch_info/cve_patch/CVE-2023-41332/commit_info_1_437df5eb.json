{
  "index": 1,
  "original_url": "https://github.com/cilium/cilium/commit/437df5eb0dbfd8cc67a932b0a9c7c9233b06d089",
  "patch_url": "https://github.com/cilium/cilium/commit/437df5eb0dbfd8cc67a932b0a9c7c9233b06d089.patch",
  "commit_info": {
    "type": "pr_commit",
    "hash": "437df5eb0dbfd8cc67a932b0a9c7c9233b06d089",
    "url": "https://github.com/cilium/cilium/commit/437df5eb0dbfd8cc67a932b0a9c7c9233b06d089",
    "pr_url": "https://github.com/cilium/cilium/pull/27597",
    "pr_number": "27597",
    "owner": "cilium",
    "repo": "cilium",
    "message": "proxy: Ignore visibility annotation if proxy is disabled\n\nThis is to avoid the below error if proxy is disabled as part of\ninstallation, but the visibility annotation is added to pods later.\n\n```\n2023-08-11T12:42:41.390575371Z goroutine 1522 [running]:\n2023-08-11T12:42:41.390581994Z github.com/cilium/cilium/pkg/proxy.(*Proxy).CreateOrUpdateRedirect(0x0, {0x3ae74b8, 0xc000650280}, {0x3aeb440?, 0xc0016e4560?}, {0xc0010ba1b0, 0x12}, {0x3afd260, 0xc000982000}, 0xc001c9c980)\n2023-08-11T12:42:41.390589198Z  github.com/cilium/cilium/pkg/proxy/proxy.go:459 +0xb7\n2023-08-11T12:42:41.390596081Z github.com/cilium/cilium/pkg/endpoint.(*Endpoint).addVisibilityRedirects(0xc000982000, 0x1, 0xc001874ba0?, 0xc001c9c980?)\n2023-08-11T12:42:41.390602613Z  github.com/cilium/cilium/pkg/endpoint/bpf.go:343 +0x443\n2023-08-11T12:42:41.390614345Z github.com/cilium/cilium/pkg/endpoint.(*Endpoint).addNewRedirects(0xc000982000, 0xc001874870?)\n2023-08-11T12:42:41.390651325Z  github.com/cilium/cilium/pkg/endpoint/bpf.go:424 +0x3c5\n2023-08-11T12:42:41.390658068Z github.com/cilium/cilium/pkg/endpoint.(*Endpoint).runPreCompilationSteps(0xc000982000, 0xc000e31800, 0x0)\n2023-08-11T12:42:41.390663999Z  github.com/cilium/cilium/pkg/endpoint/bpf.go:802 +0x4fe\n2023-08-11T12:42:41.390669690Z github.com/cilium/cilium/pkg/endpoint.(*Endpoint).regenerateBPF(0xc000982000, 0xc000e31800)\n2023-08-11T12:42:41.390675451Z  github.com/cilium/cilium/pkg/endpoint/bpf.go:542 +0x1a5\n2023-08-11T12:42:41.390681112Z github.com/cilium/cilium/pkg/endpoint.(*Endpoint).regenerate(0xc000982000, 0xc000e31800)\n2023-08-11T12:42:41.390686893Z  github.com/cilium/cilium/pkg/endpoint/policy.go:467 +0x9c6\n2023-08-11T12:42:41.390692564Z github.com/cilium/cilium/pkg/endpoint.(*EndpointRegenerationEvent).Handle(0xc000131b50, 0x0?)\n2023-08-11T12:42:41.390698385Z  github.com/cilium/cilium/pkg/endpoint/events.go:53 +0x325\n2023-08-11T12:42:41.390704045Z github.com/cilium/cilium/pkg/eventqueue.(*EventQueue).run.func1()\n2023-08-11T12:42:41.390709716Z  github.com/cilium/cilium/pkg/eventqueue/eventqueue.go:245 +0x142\n```\n\nFixes: #27594\n\nSigned-off-by: Tam Mach <tam.mach@cilium.io>",
    "author": "Tam Mach",
    "date": "2023-08-11T12:58:14Z"
  },
  "patch_stats": {
    "files_modified": 7,
    "lines_added": 21,
    "lines_removed": 7,
    "total_changes": 28,
    "file_list": [
      "Documentation/observability/visibility.rst",
      "daemon/cmd/endpoint.go",
      "pkg/endpoint/bpf.go",
      "pkg/endpoint/events.go",
      "pkg/endpoint/policy.go",
      "pkg/endpoint/policy_test.go",
      "pkg/endpoint/proxy.go"
    ],
    "file_extensions": [
      "go",
      "rst"
    ],
    "binary_files": 0
  }
}