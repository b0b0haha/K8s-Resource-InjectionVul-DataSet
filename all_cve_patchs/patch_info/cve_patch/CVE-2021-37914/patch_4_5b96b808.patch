From 5b96b8085aae92ca3715e7c435e9cee39648d9df Mon Sep 17 00:00:00 2001
From: Alex Collins <alex_collins@intuit.com>
Date: Mon, 2 Aug 2021 13:50:51 -0700
Subject: [PATCH] revert

Signed-off-by: Alex Collins <alex_collins@intuit.com>
---
 workflow/controller/operator.go | 20 +++++++++++++++++++-
 1 file changed, 19 insertions(+), 1 deletion(-)

diff --git a/workflow/controller/operator.go b/workflow/controller/operator.go
index d6aad5d698f5..b52f609b5bb6 100644
--- a/workflow/controller/operator.go
+++ b/workflow/controller/operator.go
@@ -3388,5 +3388,23 @@ func (woc *wfOperationCtx) mergedTemplateDefaultsInto(originalTmpl *wfv1.Templat
 }
 
 func (woc *wfOperationCtx) substituteGlobalVariables() error {
-	return template.Replace(&woc.execWf.Spec, woc.globalParams, true)
+	execWfSpec := *woc.execWf.Spec.DeepCopy()
+
+	// To Avoid the stale Global parameter value substitution to templates.
+	// Updated Global parameter values will be substituted in 'executetemplate' for templates.
+	execWfSpec.Templates = nil
+
+	err := template.Replace(&execWfSpec, woc.globalParams, true)
+	if err != nil {
+		return err
+	}
+	resolveSpec, err := json.Marshal(execWfSpec)
+	if err != nil {
+		return err
+	}
+	err = json.Unmarshal(resolveSpec, &woc.execWf.Spec)
+	if err != nil {
+		return err
+	}
+	return nil
 }
