From 6bc73c31e14ea2b1bfc30f359e1fe952859d9adc Mon Sep 17 00:00:00 2001
From: xcaspar <changjun.xcj@alibaba-inc.com>
Date: Sat, 30 Dec 2023 21:42:28 +0800
Subject: [PATCH] fix: Temporarily disable server mode.

Signed-off-by: xcaspar <changjun.xcj@alibaba-inc.com>
---
 cli/cmd/cmd.go          |  7 +------
 cli/cmd/server_start.go | 17 ++---------------
 2 files changed, 3 insertions(+), 21 deletions(-)

diff --git a/cli/cmd/cmd.go b/cli/cmd/cmd.go
index c1d111c1..5891593a 100644
--- a/cli/cmd/cmd.go
+++ b/cli/cmd/cmd.go
@@ -55,12 +55,7 @@ func CmdInit() *baseCommand {
 	queryCommand.AddCommand(&QueryJvmCommand{})
 	queryCommand.AddCommand(&QueryK8sCommand{})
 
-	// add server command
-	serverCommand := &ServerCommand{}
-	baseCmd.AddCommand(serverCommand)
-	serverCommand.AddCommand(&StartServerCommand{})
-	serverCommand.AddCommand(&StopServerCommand{})
-	serverCommand.AddCommand(&StatusServerCommand{})
+	// UPDATE 2023-12-30 Disable server command mode.
 
 	// add check command
 	checkCommand := &CheckCommand{}
diff --git a/cli/cmd/server_start.go b/cli/cmd/server_start.go
index 2bf1c338..8e5227ac 100644
--- a/cli/cmd/server_start.go
+++ b/cli/cmd/server_start.go
@@ -123,7 +123,7 @@ func (ssc *StartServerCommand) start0() {
 	go func() {
 		err := http.ListenAndServe(ssc.ip+":"+ssc.port, nil)
 		if err != nil {
-			log.Errorf(context.Background(),"start blade server error, %v", err)
+			log.Errorf(context.Background(), "start blade server error, %v", err)
 			//log.Error(err, "start blade server error")
 			os.Exit(1)
 		}
@@ -134,20 +134,7 @@ func (ssc *StartServerCommand) start0() {
 
 func Register(requestPath string) {
 	http.HandleFunc(requestPath, func(writer http.ResponseWriter, request *http.Request) {
-		err := request.ParseForm()
-		if err != nil {
-			fmt.Fprintf(writer, spec.ReturnFail(spec.ParameterRequestFailed, err.Error()).Print())
-			return
-		}
-		cmds := request.Form["cmd"]
-		if len(cmds) != 1 {
-			fmt.Fprintf(writer, spec.ResponseFailWithFlags(spec.ParameterLess, "cmd").Print())
-			return
-		}
-		ctx := context.WithValue(context.Background(), "mode", "server")
-		response := channel.NewLocalChannel().Run(ctx, path.Join(util.GetProgramPath(), "blade"), cmds[0])
-		log.Debugf(ctx, "Server response: %v", response)
-		fmt.Fprintf(writer, response.Print())
+		fmt.Fprintf(writer, spec.ReturnFail(spec.CommandIllegal, "Server mode is disabled").Print())
 	})
 }
 
