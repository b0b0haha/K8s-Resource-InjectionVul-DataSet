{
  "cve_id": "CVE-2021-43784",
  "description": "runc is a CLI tool for spawning and running containers on Linux according to the OCI specification. In runc, netlink is used internally as a serialization system for specifying the relevant container configuration to the `C` portion of the code (responsible for the based namespace setup of containers). In all versions of runc prior to 1.0.3, the encoder did not handle the possibility of an integer overflow in the 16-bit length field for the byte array attribute type, meaning that a large enough malicious byte array attribute could result in the length overflowing and the attribute contents being parsed as netlink messages for container configuration. This vulnerability requires the attacker to have some control over the configuration of the container and would allow the attacker to bypass the namespace restrictions of the container by simply adding their own netlink payload which disables all namespaces. The main users impacted are those who allow untrusted images with untrusted configurations to run on their machines (such as with shared cloud infrastructure). runc version 1.0.3 contains a fix for this bug. As a workaround, one may try disallowing untrusted namespace paths from your container. It should be noted that untrusted namespace paths would allow the attacker to disable namespace protections entirely even in the absence of this bug.",
  "references": [
    "https://bugs.chromium.org/p/project-zero/issues/detail?id=2241",
    "https://github.com/opencontainers/runc/commit/9c444070ec7bb83995dbc0185da68284da71c554",
    "https://github.com/opencontainers/runc/commit/d72d057ba794164c3cce9451a00b72a78b25e1ae",
    "https://github.com/opencontainers/runc/commit/f50369af4b571e358f20b139eea52d612eb55eed",
    "https://github.com/opencontainers/runc/security/advisories/GHSA-v95c-p5hm-xq8f",
    "https://lists.debian.org/debian-lts-announce/2021/12/msg00005.html",
    "https://lists.debian.org/debian-lts-announce/2024/02/msg00005.html"
  ],
  "commit_urls": [
    "https://github.com/opencontainers/runc/commit/9c444070ec7bb83995dbc0185da68284da71c554",
    "https://github.com/opencontainers/runc/commit/d72d057ba794164c3cce9451a00b72a78b25e1ae",
    "https://github.com/opencontainers/runc/commit/f50369af4b571e358f20b139eea52d612eb55eed"
  ],
  "pr_urls": [],
  "issue_urls": [],
  "advisory_urls": [
    "https://github.com/opencontainers/runc/security/advisories/GHSA-v95c-p5hm-xq8f"
  ],
  "related_commits": [
    {
      "type": "direct_commit",
      "hash": "9c444070ec7bb83995dbc0185da68284da71c554",
      "url": "https://github.com/opencontainers/runc/commit/9c444070ec7bb83995dbc0185da68284da71c554",
      "owner": "opencontainers",
      "repo": "runc",
      "message": "Open bind mount sources from the host userns\n\nThe source of the bind mount might not be accessible in a different user\nnamespace because a component of the source path might not be traversed\nunder the users and groups mapped inside the user namespace. This caused\nerrors such as the following:\n\n  # time=\"2020-06-22T13:48:26Z\" level=error msg=\"container_linux.go:367:\n  starting container process caused: process_linux.go:459:\n  container init caused: rootfs_linux.go:58:\n  mounting \\\"/tmp/busyboxtest/source-inaccessible/dir\\\"\n  to rootfs at \\\"/tmp/inaccessible\\\" caused:\n  stat /tmp/busyboxtest/source-inaccessible/dir: permission denied\"\n\nTo solve this problem, this patch performs the following:\n\n1. in nsexec.c, it opens the source path in the host userns (so we have\n   the right permissions to open it) but in the container mntns (so the\n   kernel cross mntns mount check let us mount it later:\n   https://github.com/torvalds/linux/blob/v5.8/fs/namespace.c#L2312).\n\n2. in nsexec.c, it passes the file descriptors of the source to the\n   child process with SCM_RIGHTS.\n\n3. In runc-init in Golang, it finishes the mounts while inside the\n   userns even without access to the some components of the source\n   paths.\n\nPassing the fds with SCM_RIGHTS is necessary because once the child\nprocess is in the container mntns, it is already in the container userns\nso it cannot temporarily join the host mntns.\n\nThis patch uses the existing mechanism with _LIBCONTAINER_* environment\nvariables to pass the file descriptors from runc to runc init.\n\nThis patch uses the existing mechanism with the Netlink-style bootstrap\nto pass information about the list of source mounts to nsexec.c.\n\nRootless containers don't use this bind mount sources fdpassing\nmechanism because we can't setns() to the target mntns in a rootless\ncontainer (we don't have the privileges when we are in the host userns).\n\nThis patch takes care of using O_CLOEXEC on mount fds, and close them\nearly.\n\nFixes: #2484.\n\nSigned-off-by: Alban Crequy <alban@kinvolk.io>\nSigned-off-by: Rodrigo Campos <rodrigo@kinvolk.io>\nCo-authored-by: Rodrigo Campos <rodrigo@kinvolk.io>",
      "author": "Alban Crequy",
      "date": "2020-09-03T12:41:05Z"
    },
    {
      "type": "direct_commit",
      "hash": "d72d057ba794164c3cce9451a00b72a78b25e1ae",
      "url": "https://github.com/opencontainers/runc/commit/d72d057ba794164c3cce9451a00b72a78b25e1ae",
      "owner": "opencontainers",
      "repo": "runc",
      "message": "runc init: avoid netlink message length overflows\n\nWhen writing netlink messages, it is possible to have a byte array\nlarger than UINT16_MAX which would result in the length field\noverflowing and allowing user-controlled data to be parsed as control\ncharacters (such as creating custom mount points, changing which set of\nnamespaces to allow, and so on).\n\nCo-authored-by: Kir Kolyshkin <kolyshkin@gmail.com>\nSigned-off-by: Kir Kolyshkin <kolyshkin@gmail.com>\nSigned-off-by: Aleksa Sarai <cyphar@cyphar.com>",
      "author": "Aleksa Sarai",
      "date": "2021-11-18T05:12:59Z"
    },
    {
      "type": "direct_commit",
      "hash": "f50369af4b571e358f20b139eea52d612eb55eed",
      "url": "https://github.com/opencontainers/runc/commit/f50369af4b571e358f20b139eea52d612eb55eed",
      "owner": "opencontainers",
      "repo": "runc",
      "message": "Merge pull request from GHSA-v95c-p5hm-xq8f\n\nrunc init: avoid netlink message length overflows",
      "author": "Aleksa Sarai",
      "date": "2021-12-06T04:30:29Z"
    }
  ],
  "commits": [
    "https://github.com/opencontainers/runc/commit/9c444070ec7bb83995dbc0185da68284da71c554",
    "https://github.com/opencontainers/runc/commit/d72d057ba794164c3cce9451a00b72a78b25e1ae",
    "https://github.com/opencontainers/runc/commit/f50369af4b571e358f20b139eea52d612eb55eed",
    {
      "type": "direct_commit",
      "hash": "9c444070ec7bb83995dbc0185da68284da71c554",
      "url": "https://github.com/opencontainers/runc/commit/9c444070ec7bb83995dbc0185da68284da71c554",
      "owner": "opencontainers",
      "repo": "runc",
      "message": "Open bind mount sources from the host userns\n\nThe source of the bind mount might not be accessible in a different user\nnamespace because a component of the source path might not be traversed\nunder the users and groups mapped inside the user namespace. This caused\nerrors such as the following:\n\n  # time=\"2020-06-22T13:48:26Z\" level=error msg=\"container_linux.go:367:\n  starting container process caused: process_linux.go:459:\n  container init caused: rootfs_linux.go:58:\n  mounting \\\"/tmp/busyboxtest/source-inaccessible/dir\\\"\n  to rootfs at \\\"/tmp/inaccessible\\\" caused:\n  stat /tmp/busyboxtest/source-inaccessible/dir: permission denied\"\n\nTo solve this problem, this patch performs the following:\n\n1. in nsexec.c, it opens the source path in the host userns (so we have\n   the right permissions to open it) but in the container mntns (so the\n   kernel cross mntns mount check let us mount it later:\n   https://github.com/torvalds/linux/blob/v5.8/fs/namespace.c#L2312).\n\n2. in nsexec.c, it passes the file descriptors of the source to the\n   child process with SCM_RIGHTS.\n\n3. In runc-init in Golang, it finishes the mounts while inside the\n   userns even without access to the some components of the source\n   paths.\n\nPassing the fds with SCM_RIGHTS is necessary because once the child\nprocess is in the container mntns, it is already in the container userns\nso it cannot temporarily join the host mntns.\n\nThis patch uses the existing mechanism with _LIBCONTAINER_* environment\nvariables to pass the file descriptors from runc to runc init.\n\nThis patch uses the existing mechanism with the Netlink-style bootstrap\nto pass information about the list of source mounts to nsexec.c.\n\nRootless containers don't use this bind mount sources fdpassing\nmechanism because we can't setns() to the target mntns in a rootless\ncontainer (we don't have the privileges when we are in the host userns).\n\nThis patch takes care of using O_CLOEXEC on mount fds, and close them\nearly.\n\nFixes: #2484.\n\nSigned-off-by: Alban Crequy <alban@kinvolk.io>\nSigned-off-by: Rodrigo Campos <rodrigo@kinvolk.io>\nCo-authored-by: Rodrigo Campos <rodrigo@kinvolk.io>",
      "author": "Alban Crequy",
      "date": "2020-09-03T12:41:05Z"
    },
    {
      "type": "direct_commit",
      "hash": "d72d057ba794164c3cce9451a00b72a78b25e1ae",
      "url": "https://github.com/opencontainers/runc/commit/d72d057ba794164c3cce9451a00b72a78b25e1ae",
      "owner": "opencontainers",
      "repo": "runc",
      "message": "runc init: avoid netlink message length overflows\n\nWhen writing netlink messages, it is possible to have a byte array\nlarger than UINT16_MAX which would result in the length field\noverflowing and allowing user-controlled data to be parsed as control\ncharacters (such as creating custom mount points, changing which set of\nnamespaces to allow, and so on).\n\nCo-authored-by: Kir Kolyshkin <kolyshkin@gmail.com>\nSigned-off-by: Kir Kolyshkin <kolyshkin@gmail.com>\nSigned-off-by: Aleksa Sarai <cyphar@cyphar.com>",
      "author": "Aleksa Sarai",
      "date": "2021-11-18T05:12:59Z"
    },
    {
      "type": "direct_commit",
      "hash": "f50369af4b571e358f20b139eea52d612eb55eed",
      "url": "https://github.com/opencontainers/runc/commit/f50369af4b571e358f20b139eea52d612eb55eed",
      "owner": "opencontainers",
      "repo": "runc",
      "message": "Merge pull request from GHSA-v95c-p5hm-xq8f\n\nrunc init: avoid netlink message length overflows",
      "author": "Aleksa Sarai",
      "date": "2021-12-06T04:30:29Z"
    }
  ]
}