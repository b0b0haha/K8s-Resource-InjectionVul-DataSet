From 51a7189087fb3be724bb9184aef9129ac775ac66 Mon Sep 17 00:00:00 2001
From: Stefan Prodan <stefan.prodan@gmail.com>
Date: Thu, 7 Oct 2021 14:17:02 +0300
Subject: [PATCH] Restore `spec.validation` and mark it as deprecated

Signed-off-by: Stefan Prodan <stefan.prodan@gmail.com>
---
 api/v1beta2/kustomization_types.go            |  5 ++++
 ...mize.toolkit.fluxcd.io_kustomizations.yaml |  7 ++++++
 docs/api/kustomize.md                         | 24 +++++++++++++++++++
 3 files changed, 36 insertions(+)

diff --git a/api/v1beta2/kustomization_types.go b/api/v1beta2/kustomization_types.go
index 56c4b578..9a2d9475 100644
--- a/api/v1beta2/kustomization_types.go
+++ b/api/v1beta2/kustomization_types.go
@@ -140,6 +140,11 @@ type KustomizationSpec struct {
 	// When enabled, the HealthChecks are ignored. Defaults to false.
 	// +optional
 	Wait bool `json:"wait,omitempty"`
+
+	// Deprecated: Not used in v1beta2.
+	// +kubebuilder:validation:Enum=none;client;server
+	// +optional
+	Validation string `json:"validation,omitempty"`
 }
 
 // Decryption defines how decryption is handled for Kubernetes manifests.
diff --git a/config/crd/bases/kustomize.toolkit.fluxcd.io_kustomizations.yaml b/config/crd/bases/kustomize.toolkit.fluxcd.io_kustomizations.yaml
index a97fcdb9..a22c0a4b 100644
--- a/config/crd/bases/kustomize.toolkit.fluxcd.io_kustomizations.yaml
+++ b/config/crd/bases/kustomize.toolkit.fluxcd.io_kustomizations.yaml
@@ -722,6 +722,13 @@ spec:
               timeout:
                 description: Timeout for validation, apply and health checking operations. Defaults to 'Interval' duration.
                 type: string
+              validation:
+                description: 'Deprecated: Not used in v1beta2.'
+                enum:
+                - none
+                - client
+                - server
+                type: string
               wait:
                 description: Wait instructs the controller to check the health of all the reconciled resources. When enabled, the HealthChecks are ignored. Defaults to false.
                 type: boolean
diff --git a/docs/api/kustomize.md b/docs/api/kustomize.md
index 157ec722..f3eb6935 100644
--- a/docs/api/kustomize.md
+++ b/docs/api/kustomize.md
@@ -350,6 +350,18 @@ bool
 When enabled, the HealthChecks are ignored. Defaults to false.</p>
 </td>
 </tr>
+<tr>
+<td>
+<code>validation</code><br>
+<em>
+string
+</em>
+</td>
+<td>
+<em>(Optional)</em>
+<p>Deprecated: Not used in v1beta2.</p>
+</td>
+</tr>
 </table>
 </td>
 </tr>
@@ -823,6 +835,18 @@ bool
 When enabled, the HealthChecks are ignored. Defaults to false.</p>
 </td>
 </tr>
+<tr>
+<td>
+<code>validation</code><br>
+<em>
+string
+</em>
+</td>
+<td>
+<em>(Optional)</em>
+<p>Deprecated: Not used in v1beta2.</p>
+</td>
+</tr>
 </tbody>
 </table>
 </div>
