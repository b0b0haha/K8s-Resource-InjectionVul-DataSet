From 9c8f284b7fc2ce66c6c21d6281a8156a6e3c24ff Mon Sep 17 00:00:00 2001
From: Stefan Prodan <stefan.prodan@gmail.com>
Date: Tue, 14 Sep 2021 10:16:51 +0300
Subject: [PATCH] Add `spec.wait` usage to the API docs

Signed-off-by: Stefan Prodan <stefan.prodan@gmail.com>
---
 api/v1beta2/doc.go                            |   2 +-
 api/v1beta2/groupversion_info.go              |   4 +-
 api/v1beta2/inventory_types.go                |  20 +-
 api/v1beta2/kustomization_types.go            |  17 +-
 api/v1beta2/reference_types.go                |  10 +-
 api/v1beta2/zz_generated.deepcopy.go          |  72 ++++----
 ...mize.toolkit.fluxcd.io_kustomizations.yaml |  18 +-
 controllers/kustomization_controller.go       |  13 +-
 controllers/kustomization_inventory.go        |  32 ++--
 docs/api/kustomize.md                         | 174 +++++++++---------
 docs/spec/v1beta2/kustomization.md            |  34 ++--
 11 files changed, 200 insertions(+), 196 deletions(-)

diff --git a/api/v1beta2/doc.go b/api/v1beta2/doc.go
index 209d876d..49f41c5b 100644
--- a/api/v1beta2/doc.go
+++ b/api/v1beta2/doc.go
@@ -14,7 +14,7 @@ See the License for the specific language governing permissions and
 limitations under the License.
 */
 
-// Package v1beta2 contains API Schema definitions for the kustomize v1beta2 API group
+// Package v1beta2 contains API Schema definitions for the kustomize.toolkit.fluxcd.io v1beta2 API group.
 // +kubebuilder:object:generate=true
 // +groupName=kustomize.toolkit.fluxcd.io
 package v1beta2
diff --git a/api/v1beta2/groupversion_info.go b/api/v1beta2/groupversion_info.go
index 802205bc..a970c974 100644
--- a/api/v1beta2/groupversion_info.go
+++ b/api/v1beta2/groupversion_info.go
@@ -22,10 +22,10 @@ import (
 )
 
 var (
-	// GroupVersion is group version used to register these objects
+	// GroupVersion is group version used to register these objects.
 	GroupVersion = schema.GroupVersion{Group: "kustomize.toolkit.fluxcd.io", Version: "v1beta2"}
 
-	// SchemeBuilder is used to add go types to the GroupVersionKind scheme
+	// SchemeBuilder is used to add go types to the GroupVersionKind scheme.
 	SchemeBuilder = &scheme.Builder{GroupVersion: GroupVersion}
 
 	// AddToScheme adds the types in this group-version to the given scheme.
diff --git a/api/v1beta2/inventory_types.go b/api/v1beta2/inventory_types.go
index f1d47202..f4558b52 100644
--- a/api/v1beta2/inventory_types.go
+++ b/api/v1beta2/inventory_types.go
@@ -16,18 +16,18 @@ limitations under the License.
 
 package v1beta2
 
-// Inventory is a record of objects that have been reconciled.
-type Inventory struct {
-	// Entries of Kubernetes objects IDs.
-	Entries []Entry `json:"entries"`
+// ResourceInventory contains a list of Kubernetes resource object references that have been applied by a Kustomization.
+type ResourceInventory struct {
+	// Entries of Kubernetes resource object references.
+	Entries []ResourceRef `json:"entries"`
 }
 
-// Entry contains the information necessary to locate a resource within a cluster.
-type Entry struct {
-	// ObjectID is the string representation of a Kubernetes object metadata,
+// ResourceRef contains the information necessary to locate a resource within a cluster.
+type ResourceRef struct {
+	// ID is the string representation of the Kubernetes resource object's metadata,
 	// in the format '<namespace>_<name>_<group>_<kind>'.
-	ObjectID string `json:"id"`
+	ID string `json:"id"`
 
-	// ObjectVersion is the API version of this  Kubernetes object kind.
-	ObjectVersion string `json:"v"`
+	// Version is the API version of the Kubernetes resource object's kind.
+	Version string `json:"v"`
 }
diff --git a/api/v1beta2/kustomization_types.go b/api/v1beta2/kustomization_types.go
index d23a1004..56c4b578 100644
--- a/api/v1beta2/kustomization_types.go
+++ b/api/v1beta2/kustomization_types.go
@@ -36,7 +36,7 @@ const (
 	DisabledValue             = "disabled"
 )
 
-// KustomizationSpec defines the desired state of a kustomization.
+// KustomizationSpec defines the configuration to calculate the desired state from a Source using Kustomize.
 type KustomizationSpec struct {
 	// DependsOn may contain a dependency.CrossNamespaceDependencyReference slice
 	// with references to Kustomization resources that must be ready before this
@@ -224,9 +224,9 @@ type KustomizationStatus struct {
 	// +optional
 	LastAttemptedRevision string `json:"lastAttemptedRevision,omitempty"`
 
-	// The last successfully applied revision metadata.
+	// Inventory contains the list of Kubernetes resource object references that have been successfully applied.
 	// +optional
-	Inventory *Inventory `json:"inventory,omitempty"`
+	Inventory *ResourceInventory `json:"inventory,omitempty"`
 }
 
 // KustomizationProgressing resets the conditions of the given Kustomization to a single
@@ -263,7 +263,7 @@ func KustomizationNotReady(k Kustomization, revision, reason, message string) Ku
 }
 
 // KustomizationNotReadyInventory registers a failed apply attempt of the given Kustomization.
-func KustomizationNotReadyInventory(k Kustomization, inventory *Inventory, revision, reason, message string) Kustomization {
+func KustomizationNotReadyInventory(k Kustomization, inventory *ResourceInventory, revision, reason, message string) Kustomization {
 	SetKustomizationReadiness(&k, metav1.ConditionFalse, reason, trimString(message, MaxConditionMessageLength), revision)
 	SetKustomizationHealthiness(&k, metav1.ConditionFalse, reason, reason)
 	if revision != "" {
@@ -274,7 +274,7 @@ func KustomizationNotReadyInventory(k Kustomization, inventory *Inventory, revis
 }
 
 // KustomizationReadyInventory registers a successful apply attempt of the given Kustomization.
-func KustomizationReadyInventory(k Kustomization, inventory *Inventory, revision, reason, message string) Kustomization {
+func KustomizationReadyInventory(k Kustomization, inventory *ResourceInventory, revision, reason, message string) Kustomization {
 	SetKustomizationReadiness(&k, metav1.ConditionTrue, reason, trimString(message, MaxConditionMessageLength), revision)
 	SetKustomizationHealthiness(&k, metav1.ConditionTrue, reason, reason)
 	k.Status.Inventory = inventory
@@ -315,13 +315,6 @@ func (in *Kustomization) GetStatusConditions() *[]metav1.Condition {
 	return &in.Status.Conditions
 }
 
-const (
-	// GitRepositoryIndexKey is the key used for indexing kustomizations based on their Git sources.
-	GitRepositoryIndexKey string = ".metadata.gitRepository"
-	// BucketIndexKey is the key used for indexing kustomizations based on their S3 sources.
-	BucketIndexKey string = ".metadata.bucket"
-)
-
 // +genclient
 // +genclient:Namespaced
 // +kubebuilder:storageversion
diff --git a/api/v1beta2/reference_types.go b/api/v1beta2/reference_types.go
index bb069114..0b871870 100644
--- a/api/v1beta2/reference_types.go
+++ b/api/v1beta2/reference_types.go
@@ -19,22 +19,22 @@ package v1beta2
 import "fmt"
 
 // CrossNamespaceSourceReference contains enough information to let you locate the
-// typed referenced object at cluster level
+// typed Kubernetes resource object at cluster level.
 type CrossNamespaceSourceReference struct {
-	// API version of the referent
+	// API version of the referent.
 	// +optional
 	APIVersion string `json:"apiVersion,omitempty"`
 
-	// Kind of the referent
+	// Kind of the referent.
 	// +kubebuilder:validation:Enum=GitRepository;Bucket
 	// +required
 	Kind string `json:"kind"`
 
-	// Name of the referent
+	// Name of the referent.
 	// +required
 	Name string `json:"name"`
 
-	// Namespace of the referent, defaults to the Kustomization namespace
+	// Namespace of the referent, defaults to the namespace of the Kubernetes resource object that contains the reference.
 	// +optional
 	Namespace string `json:"namespace,omitempty"`
 }
diff --git a/api/v1beta2/zz_generated.deepcopy.go b/api/v1beta2/zz_generated.deepcopy.go
index e6a5db62..b1abce6f 100644
--- a/api/v1beta2/zz_generated.deepcopy.go
+++ b/api/v1beta2/zz_generated.deepcopy.go
@@ -64,41 +64,6 @@ func (in *Decryption) DeepCopy() *Decryption {
 	return out
 }
 
-// DeepCopyInto is an autogenerated deepcopy function, copying the receiver, writing into out. in must be non-nil.
-func (in *Entry) DeepCopyInto(out *Entry) {
-	*out = *in
-}
-
-// DeepCopy is an autogenerated deepcopy function, copying the receiver, creating a new Entry.
-func (in *Entry) DeepCopy() *Entry {
-	if in == nil {
-		return nil
-	}
-	out := new(Entry)
-	in.DeepCopyInto(out)
-	return out
-}
-
-// DeepCopyInto is an autogenerated deepcopy function, copying the receiver, writing into out. in must be non-nil.
-func (in *Inventory) DeepCopyInto(out *Inventory) {
-	*out = *in
-	if in.Entries != nil {
-		in, out := &in.Entries, &out.Entries
-		*out = make([]Entry, len(*in))
-		copy(*out, *in)
-	}
-}
-
-// DeepCopy is an autogenerated deepcopy function, copying the receiver, creating a new Inventory.
-func (in *Inventory) DeepCopy() *Inventory {
-	if in == nil {
-		return nil
-	}
-	out := new(Inventory)
-	in.DeepCopyInto(out)
-	return out
-}
-
 // DeepCopyInto is an autogenerated deepcopy function, copying the receiver, writing into out. in must be non-nil.
 func (in *KubeConfig) DeepCopyInto(out *KubeConfig) {
 	*out = *in
@@ -263,7 +228,7 @@ func (in *KustomizationStatus) DeepCopyInto(out *KustomizationStatus) {
 	}
 	if in.Inventory != nil {
 		in, out := &in.Inventory, &out.Inventory
-		*out = new(Inventory)
+		*out = new(ResourceInventory)
 		(*in).DeepCopyInto(*out)
 	}
 }
@@ -305,6 +270,41 @@ func (in *PostBuild) DeepCopy() *PostBuild {
 	return out
 }
 
+// DeepCopyInto is an autogenerated deepcopy function, copying the receiver, writing into out. in must be non-nil.
+func (in *ResourceInventory) DeepCopyInto(out *ResourceInventory) {
+	*out = *in
+	if in.Entries != nil {
+		in, out := &in.Entries, &out.Entries
+		*out = make([]ResourceRef, len(*in))
+		copy(*out, *in)
+	}
+}
+
+// DeepCopy is an autogenerated deepcopy function, copying the receiver, creating a new ResourceInventory.
+func (in *ResourceInventory) DeepCopy() *ResourceInventory {
+	if in == nil {
+		return nil
+	}
+	out := new(ResourceInventory)
+	in.DeepCopyInto(out)
+	return out
+}
+
+// DeepCopyInto is an autogenerated deepcopy function, copying the receiver, writing into out. in must be non-nil.
+func (in *ResourceRef) DeepCopyInto(out *ResourceRef) {
+	*out = *in
+}
+
+// DeepCopy is an autogenerated deepcopy function, copying the receiver, creating a new ResourceRef.
+func (in *ResourceRef) DeepCopy() *ResourceRef {
+	if in == nil {
+		return nil
+	}
+	out := new(ResourceRef)
+	in.DeepCopyInto(out)
+	return out
+}
+
 // DeepCopyInto is an autogenerated deepcopy function, copying the receiver, writing into out. in must be non-nil.
 func (in *SubstituteReference) DeepCopyInto(out *SubstituteReference) {
 	*out = *in
diff --git a/config/crd/bases/kustomize.toolkit.fluxcd.io_kustomizations.yaml b/config/crd/bases/kustomize.toolkit.fluxcd.io_kustomizations.yaml
index 7094da0b..a49f866f 100644
--- a/config/crd/bases/kustomize.toolkit.fluxcd.io_kustomizations.yaml
+++ b/config/crd/bases/kustomize.toolkit.fluxcd.io_kustomizations.yaml
@@ -447,7 +447,7 @@ spec:
           metadata:
             type: object
           spec:
-            description: KustomizationSpec defines the desired state of a kustomization.
+            description: KustomizationSpec defines the configuration to calculate the desired state from a Source using Kustomize.
             properties:
               decryption:
                 description: Decrypt Kubernetes secrets before applying them on the cluster.
@@ -693,19 +693,19 @@ spec:
                 description: Reference of the source where the kustomization file is.
                 properties:
                   apiVersion:
-                    description: API version of the referent
+                    description: API version of the referent.
                     type: string
                   kind:
-                    description: Kind of the referent
+                    description: Kind of the referent.
                     enum:
                     - GitRepository
                     - Bucket
                     type: string
                   name:
-                    description: Name of the referent
+                    description: Name of the referent.
                     type: string
                   namespace:
-                    description: Namespace of the referent, defaults to the Kustomization namespace
+                    description: Namespace of the referent, defaults to the namespace of the Kubernetes resource object that contains the reference.
                     type: string
                 required:
                 - kind
@@ -782,15 +782,15 @@ spec:
                 description: The last successfully applied revision metadata.
                 properties:
                   entries:
-                    description: Entries of Kubernetes objects IDs.
+                    description: Entries of Kubernetes resource object references.
                     items:
-                      description: Entry contains the information necessary to locate a resource within a cluster.
+                      description: ResourceRef contains the information necessary to locate a resource within a cluster.
                       properties:
                         id:
-                          description: ObjectID is the string representation of a Kubernetes object metadata, in the format '<namespace>_<name>_<group>_<kind>'.
+                          description: ID is the string representation of the Kubernetes resource object's metadata, in the format '<namespace>_<name>_<group>_<kind>'.
                           type: string
                         v:
-                          description: ObjectVersion is the API version of this  Kubernetes object kind.
+                          description: Version is the API version of the Kubernetes resource object's kind.
                           type: string
                       required:
                       - id
diff --git a/controllers/kustomization_controller.go b/controllers/kustomization_controller.go
index 1a02d904..7db0c5d3 100644
--- a/controllers/kustomization_controller.go
+++ b/controllers/kustomization_controller.go
@@ -90,14 +90,19 @@ type KustomizationReconcilerOptions struct {
 }
 
 func (r *KustomizationReconciler) SetupWithManager(mgr ctrl.Manager, opts KustomizationReconcilerOptions) error {
+	const (
+		gitRepositoryIndexKey string = ".metadata.gitRepository"
+		bucketIndexKey        string = ".metadata.bucket"
+	)
+
 	// Index the Kustomizations by the GitRepository references they (may) point at.
-	if err := mgr.GetCache().IndexField(context.TODO(), &kustomizev1.Kustomization{}, kustomizev1.GitRepositoryIndexKey,
+	if err := mgr.GetCache().IndexField(context.TODO(), &kustomizev1.Kustomization{}, gitRepositoryIndexKey,
 		r.indexBy(sourcev1.GitRepositoryKind)); err != nil {
 		return fmt.Errorf("failed setting index fields: %w", err)
 	}
 
 	// Index the Kustomizations by the Bucket references they (may) point at.
-	if err := mgr.GetCache().IndexField(context.TODO(), &kustomizev1.Kustomization{}, kustomizev1.BucketIndexKey,
+	if err := mgr.GetCache().IndexField(context.TODO(), &kustomizev1.Kustomization{}, bucketIndexKey,
 		r.indexBy(sourcev1.BucketKind)); err != nil {
 		return fmt.Errorf("failed setting index fields: %w", err)
 	}
@@ -119,12 +124,12 @@ func (r *KustomizationReconciler) SetupWithManager(mgr ctrl.Manager, opts Kustom
 		)).
 		Watches(
 			&source.Kind{Type: &sourcev1.GitRepository{}},
-			handler.EnqueueRequestsFromMapFunc(r.requestsForRevisionChangeOf(kustomizev1.GitRepositoryIndexKey)),
+			handler.EnqueueRequestsFromMapFunc(r.requestsForRevisionChangeOf(gitRepositoryIndexKey)),
 			builder.WithPredicates(SourceRevisionChangePredicate{}),
 		).
 		Watches(
 			&source.Kind{Type: &sourcev1.Bucket{}},
-			handler.EnqueueRequestsFromMapFunc(r.requestsForRevisionChangeOf(kustomizev1.BucketIndexKey)),
+			handler.EnqueueRequestsFromMapFunc(r.requestsForRevisionChangeOf(bucketIndexKey)),
 			builder.WithPredicates(SourceRevisionChangePredicate{}),
 		).
 		WithOptions(controller.Options{MaxConcurrentReconciles: opts.MaxConcurrentReconciles}).
diff --git a/controllers/kustomization_inventory.go b/controllers/kustomization_inventory.go
index 52443d7b..712c1bfa 100644
--- a/controllers/kustomization_inventory.go
+++ b/controllers/kustomization_inventory.go
@@ -28,14 +28,14 @@ import (
 	"github.com/fluxcd/kustomize-controller/internal/objectutil"
 )
 
-func NewInventory() *kustomizev1.Inventory {
-	return &kustomizev1.Inventory{
-		Entries: []kustomizev1.Entry{},
+func NewInventory() *kustomizev1.ResourceInventory {
+	return &kustomizev1.ResourceInventory{
+		Entries: []kustomizev1.ResourceRef{},
 	}
 }
 
 // AddObjectsToInventory extracts the metadata from the given objects and adds it to the inventory.
-func AddObjectsToInventory(inv *kustomizev1.Inventory, objects []*unstructured.Unstructured) error {
+func AddObjectsToInventory(inv *kustomizev1.ResourceInventory, objects []*unstructured.Unstructured) error {
 	sort.Sort(objectutil.SortableUnstructureds(objects))
 	for _, om := range objects {
 		objMetadata := object.UnstructuredToObjMeta(om)
@@ -44,9 +44,9 @@ func AddObjectsToInventory(inv *kustomizev1.Inventory, objects []*unstructured.U
 			return err
 		}
 
-		inv.Entries = append(inv.Entries, kustomizev1.Entry{
-			ObjectID:      objMetadata.String(),
-			ObjectVersion: gv.Version,
+		inv.Entries = append(inv.Entries, kustomizev1.ResourceRef{
+			ID:      objMetadata.String(),
+			Version: gv.Version,
 		})
 	}
 
@@ -54,11 +54,11 @@ func AddObjectsToInventory(inv *kustomizev1.Inventory, objects []*unstructured.U
 }
 
 // ListObjectsInInventory returns the inventory entries as unstructured.Unstructured objects.
-func ListObjectsInInventory(inv *kustomizev1.Inventory) ([]*unstructured.Unstructured, error) {
+func ListObjectsInInventory(inv *kustomizev1.ResourceInventory) ([]*unstructured.Unstructured, error) {
 	objects := make([]*unstructured.Unstructured, 0)
 
 	for _, entry := range inv.Entries {
-		objMetadata, err := object.ParseObjMetadata(entry.ObjectID)
+		objMetadata, err := object.ParseObjMetadata(entry.ID)
 		if err != nil {
 			return nil, err
 		}
@@ -67,7 +67,7 @@ func ListObjectsInInventory(inv *kustomizev1.Inventory) ([]*unstructured.Unstruc
 		u.SetGroupVersionKind(schema.GroupVersionKind{
 			Group:   objMetadata.GroupKind.Group,
 			Kind:    objMetadata.GroupKind.Kind,
-			Version: entry.ObjectVersion,
+			Version: entry.Version,
 		})
 		u.SetName(objMetadata.Name)
 		u.SetNamespace(objMetadata.Namespace)
@@ -79,10 +79,10 @@ func ListObjectsInInventory(inv *kustomizev1.Inventory) ([]*unstructured.Unstruc
 }
 
 // ListMetaInInventory returns the inventory entries as object.ObjMetadata objects.
-func ListMetaInInventory(inv *kustomizev1.Inventory) ([]object.ObjMetadata, error) {
+func ListMetaInInventory(inv *kustomizev1.ResourceInventory) ([]object.ObjMetadata, error) {
 	var metas []object.ObjMetadata
 	for _, e := range inv.Entries {
-		m, err := object.ParseObjMetadata(e.ObjectID)
+		m, err := object.ParseObjMetadata(e.ID)
 		if err != nil {
 			return metas, err
 		}
@@ -93,11 +93,11 @@ func ListMetaInInventory(inv *kustomizev1.Inventory) ([]object.ObjMetadata, erro
 }
 
 // DiffInventory returns the slice of objects that do not exist in the target inventory.
-func DiffInventory(inv *kustomizev1.Inventory, target *kustomizev1.Inventory) ([]*unstructured.Unstructured, error) {
-	versionOf := func(i *kustomizev1.Inventory, objMetadata object.ObjMetadata) string {
+func DiffInventory(inv *kustomizev1.ResourceInventory, target *kustomizev1.ResourceInventory) ([]*unstructured.Unstructured, error) {
+	versionOf := func(i *kustomizev1.ResourceInventory, objMetadata object.ObjMetadata) string {
 		for _, entry := range i.Entries {
-			if entry.ObjectID == objMetadata.String() {
-				return entry.ObjectVersion
+			if entry.ID == objMetadata.String() {
+				return entry.Version
 			}
 		}
 		return ""
diff --git a/docs/api/kustomize.md b/docs/api/kustomize.md
index fb2ac18c..4d963eb7 100644
--- a/docs/api/kustomize.md
+++ b/docs/api/kustomize.md
@@ -6,7 +6,7 @@
 </li>
 </ul>
 <h2 id="kustomize.toolkit.fluxcd.io/v1beta2">kustomize.toolkit.fluxcd.io/v1beta2</h2>
-<p>Package v1beta2 contains API Schema definitions for the kustomize v1beta2 API group</p>
+<p>Package v1beta2 contains API Schema definitions for the kustomize.toolkit.fluxcd.io v1beta2 API group.</p>
 Resource Types:
 <ul class="simple"><li>
 <a href="#kustomize.toolkit.fluxcd.io/v1beta2.Kustomization">Kustomization</a>
@@ -376,7 +376,7 @@ KustomizationStatus
 <a href="#kustomize.toolkit.fluxcd.io/v1beta2.KustomizationSpec">KustomizationSpec</a>)
 </p>
 <p>CrossNamespaceSourceReference contains enough information to let you locate the
-typed referenced object at cluster level</p>
+typed Kubernetes resource object at cluster level.</p>
 <div class="md-typeset__scrollwrap">
 <div class="md-typeset__table">
 <table>
@@ -396,7 +396,7 @@ string
 </td>
 <td>
 <em>(Optional)</em>
-<p>API version of the referent</p>
+<p>API version of the referent.</p>
 </td>
 </tr>
 <tr>
@@ -407,7 +407,7 @@ string
 </em>
 </td>
 <td>
-<p>Kind of the referent</p>
+<p>Kind of the referent.</p>
 </td>
 </tr>
 <tr>
@@ -418,7 +418,7 @@ string
 </em>
 </td>
 <td>
-<p>Name of the referent</p>
+<p>Name of the referent.</p>
 </td>
 </tr>
 <tr>
@@ -430,7 +430,7 @@ string
 </td>
 <td>
 <em>(Optional)</em>
-<p>Namespace of the referent, defaults to the Kustomization namespace</p>
+<p>Namespace of the referent, defaults to the namespace of the Kubernetes resource object that contains the reference.</p>
 </td>
 </tr>
 </tbody>
@@ -483,84 +483,6 @@ github.com/fluxcd/pkg/apis/meta.LocalObjectReference
 </table>
 </div>
 </div>
-<h3 id="kustomize.toolkit.fluxcd.io/v1beta2.Entry">Entry
-</h3>
-<p>
-(<em>Appears on:</em>
-<a href="#kustomize.toolkit.fluxcd.io/v1beta2.Inventory">Inventory</a>)
-</p>
-<p>Entry contains the information necessary to locate a resource within a cluster.</p>
-<div class="md-typeset__scrollwrap">
-<div class="md-typeset__table">
-<table>
-<thead>
-<tr>
-<th>Field</th>
-<th>Description</th>
-</tr>
-</thead>
-<tbody>
-<tr>
-<td>
-<code>id</code><br>
-<em>
-string
-</em>
-</td>
-<td>
-<p>ObjectID is the string representation of a Kubernetes object metadata,
-in the format &lsquo;<namespace><em><name></em><group>_<kind>&rsquo;.</p>
-</td>
-</tr>
-<tr>
-<td>
-<code>v</code><br>
-<em>
-string
-</em>
-</td>
-<td>
-<p>ObjectVersion is the API version of this  Kubernetes object kind.</p>
-</td>
-</tr>
-</tbody>
-</table>
-</div>
-</div>
-<h3 id="kustomize.toolkit.fluxcd.io/v1beta2.Inventory">Inventory
-</h3>
-<p>
-(<em>Appears on:</em>
-<a href="#kustomize.toolkit.fluxcd.io/v1beta2.KustomizationStatus">KustomizationStatus</a>)
-</p>
-<p>Inventory is a record of objects that have been reconciled.</p>
-<div class="md-typeset__scrollwrap">
-<div class="md-typeset__table">
-<table>
-<thead>
-<tr>
-<th>Field</th>
-<th>Description</th>
-</tr>
-</thead>
-<tbody>
-<tr>
-<td>
-<code>entries</code><br>
-<em>
-<a href="#kustomize.toolkit.fluxcd.io/v1beta2.Entry">
-[]Entry
-</a>
-</em>
-</td>
-<td>
-<p>Entries of Kubernetes objects IDs.</p>
-</td>
-</tr>
-</tbody>
-</table>
-</div>
-</div>
 <h3 id="kustomize.toolkit.fluxcd.io/v1beta2.KubeConfig">KubeConfig
 </h3>
 <p>
@@ -608,7 +530,7 @@ the Kustomization.</p>
 (<em>Appears on:</em>
 <a href="#kustomize.toolkit.fluxcd.io/v1beta2.Kustomization">Kustomization</a>)
 </p>
-<p>KustomizationSpec defines the desired state of a kustomization.</p>
+<p>KustomizationSpec defines the configuration to calculate the desired state from a Source using Kustomize.</p>
 <div class="md-typeset__scrollwrap">
 <div class="md-typeset__table">
 <table>
@@ -991,8 +913,8 @@ string
 <td>
 <code>inventory</code><br>
 <em>
-<a href="#kustomize.toolkit.fluxcd.io/v1beta2.Inventory">
-Inventory
+<a href="#kustomize.toolkit.fluxcd.io/v1beta2.ResourceInventory">
+ResourceInventory
 </a>
 </em>
 </td>
@@ -1061,6 +983,84 @@ must match the vars declared in the manifests for the substitution to happen.</p
 </table>
 </div>
 </div>
+<h3 id="kustomize.toolkit.fluxcd.io/v1beta2.ResourceInventory">ResourceInventory
+</h3>
+<p>
+(<em>Appears on:</em>
+<a href="#kustomize.toolkit.fluxcd.io/v1beta2.KustomizationStatus">KustomizationStatus</a>)
+</p>
+<p>ResourceInventory contains a list of Kubernetes resource object references that have been applied by a Kustomization.</p>
+<div class="md-typeset__scrollwrap">
+<div class="md-typeset__table">
+<table>
+<thead>
+<tr>
+<th>Field</th>
+<th>Description</th>
+</tr>
+</thead>
+<tbody>
+<tr>
+<td>
+<code>entries</code><br>
+<em>
+<a href="#kustomize.toolkit.fluxcd.io/v1beta2.ResourceRef">
+[]ResourceRef
+</a>
+</em>
+</td>
+<td>
+<p>Entries of Kubernetes resource object references.</p>
+</td>
+</tr>
+</tbody>
+</table>
+</div>
+</div>
+<h3 id="kustomize.toolkit.fluxcd.io/v1beta2.ResourceRef">ResourceRef
+</h3>
+<p>
+(<em>Appears on:</em>
+<a href="#kustomize.toolkit.fluxcd.io/v1beta2.ResourceInventory">ResourceInventory</a>)
+</p>
+<p>ResourceRef contains the information necessary to locate a resource within a cluster.</p>
+<div class="md-typeset__scrollwrap">
+<div class="md-typeset__table">
+<table>
+<thead>
+<tr>
+<th>Field</th>
+<th>Description</th>
+</tr>
+</thead>
+<tbody>
+<tr>
+<td>
+<code>id</code><br>
+<em>
+string
+</em>
+</td>
+<td>
+<p>ID is the string representation of the Kubernetes resource object&rsquo;s metadata,
+in the format &lsquo;<namespace><em><name></em><group>_<kind>&rsquo;.</p>
+</td>
+</tr>
+<tr>
+<td>
+<code>v</code><br>
+<em>
+string
+</em>
+</td>
+<td>
+<p>Version is the API version of the Kubernetes resource object&rsquo;s kind.</p>
+</td>
+</tr>
+</tbody>
+</table>
+</div>
+</div>
 <h3 id="kustomize.toolkit.fluxcd.io/v1beta2.SubstituteReference">SubstituteReference
 </h3>
 <p>
diff --git a/docs/spec/v1beta2/kustomization.md b/docs/spec/v1beta2/kustomization.md
index 371fdd97..b15b06a5 100644
--- a/docs/spec/v1beta2/kustomization.md
+++ b/docs/spec/v1beta2/kustomization.md
@@ -51,10 +51,12 @@ type KustomizationSpec struct {
 	// +required
 	Prune bool `json:"prune"`
 
-	// A list of resources to be included in the health assessment.
+	// Force instructs the controller to recreate resources
+	// when patching fails due to an immutable field change.
+	// +kubebuilder:default:=false
 	// +optional
-	HealthChecks []meta.NamespacedObjectKindReference `json:"healthChecks,omitempty"`
-
+	Force bool `json:"force,omitempty"`
+	
 	// Strategic merge and JSON patches, defined as inline YAML objects,
 	// capable of targeting objects based on kind, label and annotation selectors.
 	// +optional
@@ -90,11 +92,14 @@ type KustomizationSpec struct {
 	// +optional
 	Timeout *metav1.Duration `json:"timeout,omitempty"`
 	
-	// Force instructs the controller to recreate resources
-	// when patching fails due to an immutable field change.
-	// +kubebuilder:default:=false
+	// A list of resources to be included in the health assessment.
 	// +optional
-	Force bool `json:"force,omitempty"`
+	HealthChecks []meta.NamespacedObjectKindReference `json:"healthChecks,omitempty"`
+
+	// Wait instructs the controller to check the health of all the reconciled resources.
+	// When enabled, the HealthChecks are ignored. Defaults to false.
+	// +optional
+	Wait bool `json:"wait,omitempty"`
 }
 ```
 
@@ -178,9 +183,10 @@ type KustomizationStatus struct {
 	// +optional
 	LastHandledReconcileAt string `json:"lastHandledReconcileAt,omitempty"`
 
-	// The last successfully applied revision metadata.
+	// Inventory contains the list of Kubernetes resource object references
+	// that have been successfully applied.
 	// +optional
-	Inventory *Inventory `json:"inventory"`
+	Inventory *ResourceInventory `json:"inventory,omitempty"`
 }
 ```
 
@@ -233,10 +239,6 @@ const (
 	// HealthCheckFailedReason represents the fact that
 	// one of the health checks of the Kustomization failed.
 	HealthCheckFailedReason string = "HealthCheckFailed"
-
-	// ValidationFailedReason represents the fact that the
-	// validation of the Kustomization manifests has failed.
-	ValidationFailedReason string = "ValidationFailed"
 )
 ```
 
@@ -300,7 +302,7 @@ kustomize build | kubeval --ignore-missing-schemas
 
 The Kustomization `spec.interval` tells the controller at which interval to fetch the
 Kubernetes manifest for the source, build the Kustomization and apply it on the cluster.
-The interval time units are `s`, `m` and `h` e.g. `interval: 5m`, the minimum value should be over 60 seconds.
+The interval time units are `s` and `m` e.g. `interval: 5m`, the minimum value should be over 60 seconds.
 
 The Kustomization execution can be suspended by setting `spec.suspend` to `true`.
 
@@ -359,6 +361,10 @@ A Kustomization can contain a series of health checks used to determine the
 [rollout status](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#deployment-status)
 of the deployed workloads and the ready status of custom resources.
 
+To enabled health checking for all the reconciled resources, set `spec.wait` to `true`.
+If you wish to select only certain resources, list them under `spec.healthChecks`.
+Note that when `spec.wait` is enabled, the `spec.healthChecks` field is ignored.
+
 A health check entry can reference one of the following types:
 
 * Kubernetes builtin kinds: Deployment, DaemonSet, StatefulSet, PersistentVolumeClaim, Pod, PodDisruptionBudget, Job, CronJob, Service, Secret, ConfigMap, CustomResourceDefinition
