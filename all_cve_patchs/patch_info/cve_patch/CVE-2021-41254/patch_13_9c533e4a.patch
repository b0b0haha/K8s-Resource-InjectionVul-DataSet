From 9c533e4a52e0687c9e02167964bdb20135d240fc Mon Sep 17 00:00:00 2001
From: Stefan Prodan <stefan.prodan@gmail.com>
Date: Tue, 14 Sep 2021 10:22:49 +0300
Subject: [PATCH] Run SSA resource manager tests in CI

Signed-off-by: Stefan Prodan <stefan.prodan@gmail.com>
---
 .github/workflows/e2e.yaml                      |  4 +++-
 ...tomize.toolkit.fluxcd.io_kustomizations.yaml |  2 +-
 docs/api/kustomize.md                           |  2 +-
 internal/ssa/main_test.go                       | 17 +++++++++++++++++
 internal/ssa/manager_apply_test.go              | 17 +++++++++++++++++
 internal/ssa/manager_delete_test.go             | 17 +++++++++++++++++
 internal/ssa/manager_diff_test.go               | 17 +++++++++++++++++
 7 files changed, 73 insertions(+), 3 deletions(-)

diff --git a/.github/workflows/e2e.yaml b/.github/workflows/e2e.yaml
index e25b2159..6bdec2b4 100644
--- a/.github/workflows/e2e.yaml
+++ b/.github/workflows/e2e.yaml
@@ -34,7 +34,9 @@ jobs:
         uses: fluxcd/pkg/actions/kubectl@main
         with:
           version: 1.21.2
-      - name: Run tests
+      - name: Run internal tests
+        run: make test-internal
+      - name: Run controller tests
         run: make test
       - name: Check if working tree is dirty
         run: |
diff --git a/config/crd/bases/kustomize.toolkit.fluxcd.io_kustomizations.yaml b/config/crd/bases/kustomize.toolkit.fluxcd.io_kustomizations.yaml
index a49f866f..a97fcdb9 100644
--- a/config/crd/bases/kustomize.toolkit.fluxcd.io_kustomizations.yaml
+++ b/config/crd/bases/kustomize.toolkit.fluxcd.io_kustomizations.yaml
@@ -779,7 +779,7 @@ spec:
                   type: object
                 type: array
               inventory:
-                description: The last successfully applied revision metadata.
+                description: Inventory contains the list of Kubernetes resource object references that have been successfully applied.
                 properties:
                   entries:
                     description: Entries of Kubernetes resource object references.
diff --git a/docs/api/kustomize.md b/docs/api/kustomize.md
index 4d963eb7..157ec722 100644
--- a/docs/api/kustomize.md
+++ b/docs/api/kustomize.md
@@ -920,7 +920,7 @@ ResourceInventory
 </td>
 <td>
 <em>(Optional)</em>
-<p>The last successfully applied revision metadata.</p>
+<p>Inventory contains the list of Kubernetes resource object references that have been successfully applied.</p>
 </td>
 </tr>
 </tbody>
diff --git a/internal/ssa/main_test.go b/internal/ssa/main_test.go
index 90080c44..513fa8bb 100644
--- a/internal/ssa/main_test.go
+++ b/internal/ssa/main_test.go
@@ -1,3 +1,20 @@
+/*
+Copyright 2021 Stefan Prodan
+Copyright 2021 The Flux authors
+
+Licensed under the Apache License, Version 2.0 (the "License");
+you may not use this file except in compliance with the License.
+You may obtain a copy of the License at
+
+    http://www.apache.org/licenses/LICENSE-2.0
+
+Unless required by applicable law or agreed to in writing, software
+distributed under the License is distributed on an "AS IS" BASIS,
+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+See the License for the specific language governing permissions and
+limitations under the License.
+*/
+
 package ssa
 
 import (
diff --git a/internal/ssa/manager_apply_test.go b/internal/ssa/manager_apply_test.go
index 4074c586..58f3ee21 100644
--- a/internal/ssa/manager_apply_test.go
+++ b/internal/ssa/manager_apply_test.go
@@ -1,3 +1,20 @@
+/*
+Copyright 2021 Stefan Prodan
+Copyright 2021 The Flux authors
+
+Licensed under the Apache License, Version 2.0 (the "License");
+you may not use this file except in compliance with the License.
+You may obtain a copy of the License at
+
+    http://www.apache.org/licenses/LICENSE-2.0
+
+Unless required by applicable law or agreed to in writing, software
+distributed under the License is distributed on an "AS IS" BASIS,
+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+See the License for the specific language governing permissions and
+limitations under the License.
+*/
+
 package ssa
 
 import (
diff --git a/internal/ssa/manager_delete_test.go b/internal/ssa/manager_delete_test.go
index eae66e7b..017c4cd8 100644
--- a/internal/ssa/manager_delete_test.go
+++ b/internal/ssa/manager_delete_test.go
@@ -1,3 +1,20 @@
+/*
+Copyright 2021 Stefan Prodan
+Copyright 2021 The Flux authors
+
+Licensed under the Apache License, Version 2.0 (the "License");
+you may not use this file except in compliance with the License.
+You may obtain a copy of the License at
+
+    http://www.apache.org/licenses/LICENSE-2.0
+
+Unless required by applicable law or agreed to in writing, software
+distributed under the License is distributed on an "AS IS" BASIS,
+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+See the License for the specific language governing permissions and
+limitations under the License.
+*/
+
 package ssa
 
 import (
diff --git a/internal/ssa/manager_diff_test.go b/internal/ssa/manager_diff_test.go
index 1769841d..9ee48972 100644
--- a/internal/ssa/manager_diff_test.go
+++ b/internal/ssa/manager_diff_test.go
@@ -1,3 +1,20 @@
+/*
+Copyright 2021 Stefan Prodan
+Copyright 2021 The Flux authors
+
+Licensed under the Apache License, Version 2.0 (the "License");
+you may not use this file except in compliance with the License.
+You may obtain a copy of the License at
+
+    http://www.apache.org/licenses/LICENSE-2.0
+
+Unless required by applicable law or agreed to in writing, software
+distributed under the License is distributed on an "AS IS" BASIS,
+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+See the License for the specific language governing permissions and
+limitations under the License.
+*/
+
 package ssa
 
 import (
