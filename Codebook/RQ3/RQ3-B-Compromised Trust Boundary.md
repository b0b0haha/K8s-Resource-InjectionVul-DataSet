# RQ3-B 信任边界突破分析Codebook

## 1. 总体说明

### 1.1 分析目标
本Codebook用于指导Kubernetes资源注入漏洞中信任边界突破的识别和分类，重点关注攻击者如何通过资源注入漏洞打破Kubernetes架构中的信任边界。

### 1.2 关键概念定义
- **信任边界**：Kubernetes架构中不同组件或层次之间的安全隔离界限
- **信任边界突破**：攻击者通过资源注入漏洞跨越原本应该隔离的安全边界
- **架构层次**：控制平面、数据平面、宿主机、外部网络等不同的系统层次

### 1.3 分析范围
基于论文中Figure 3a的信任边界分类，重点关注6种主要的信任边界突破类型

---

## 2. 信任边界分类框架

### 2.1 数据平面（容器）到宿主机 (Data Plane Container to Host)

#### 定义
通过数据平面的资源注入实现容器逃逸，绕过容器隔离机制访问宿主机资源

#### 攻击机制
- 恶意Pod注解注入系统属性
- 容器配置注入危险挂载点
- 特权容器配置滥用

#### 典型案例示例
- **CVE-2024-3154**：通过恶意Pod注解注入systemd属性（如ExecStart），绕过容器隔离

#### 识别特征
- 涉及Pod配置字段的注入
- 最终影响宿主机系统服务
- 绕过容器运行时安全机制

### 2.2 数据平面到控制平面 (Data Plane to Control Plane)

#### 定义
通过数据平面的资源注入获取或修改存储在数据平面中的控制平面内容

#### 攻击机制
- 访问服务账户令牌
- 读取控制平面配置文件
- 利用共享存储访问敏感信息

#### 典型案例示例
- **CVE-2021-25741** & **CVE-2021-25745**：如论文Figure 2所示，通过Ingress资源注入访问服务账户令牌目录

#### 识别特征
- 数据平面组件访问控制平面凭据
- 利用配置文件或令牌获得控制平面权限
- 跨平面的权限提升

### 2.3 控制平面组件间 (Inter-Control Plane Components)

#### 定义
利用一个控制平面组件注入的恶意内容来探测或操作其他控制平面组件

#### 攻击机制
- SSRF攻击探测内部服务
- 组件间通信劫持
- 配置传播污染

#### 典型案例示例
- **CVE-2022-29164**：SSRF攻击在控制平面组件间传播

#### 识别特征
- 组件间网络通信异常
- 配置或数据在组件间恶意传播
- 内部API的非授权访问

### 2.4 多租户隔离突破 (Multi-Tenant Isolation)

#### 定义
通过恶意资源引用打破命名空间隔离，访问其他租户的资源

#### 攻击机制
- 跨命名空间资源引用
- 权限验证绕过
- 资源引用链攻击

#### 典型案例示例
- **CVE-2024-43803**：在Section V-A2a中讨论的跨命名空间Secret访问

#### 识别特征
- 跨命名空间的资源访问
- 租户隔离策略失效
- 未授权的资源引用

### 2.5 外部到内部集群 (External to Internal Cluster)

#### 定义
攻击者通过资源注入将内部集群组件暴露给外部访问

#### 攻击机制
- 恶意服务暴露内部资源
- 网络策略绕过
- 内部API外部化

#### 典型案例示例
- **CVE-2021-32783**：创建恶意ExternalName服务链接到Ingress路由，使内部资源可被外部访问

#### 识别特征
- 内部服务意外对外暴露
- 网络边界被突破
- 外部流量访问内部资源

### 2.6 控制平面到数据平面 (Control Plane to Data Plane)

#### 定义
被攻陷的控制器向数据平面分发恶意工作负载和配置

#### 攻击机制
- 控制器逻辑污染
- 恶意资源部署
- 配置传播攻击

#### 典型案例示例
- **CVE-2022-21701**：攻击者创建恶意Gateway对象，Istiod控制器处理后部署关联资源（如Pod），在数据平面传播恶意工作负载

#### 识别特征
- 控制器行为异常
- 恶意配置向数据平面传播
- 批量异常资源部署

---

## 3. 信任边界分析方法

### 3.1 识别步骤

#### Step 1: 确定攻击起点
- 识别恶意注入的资源类型和字段
- 确定注入发生的架构层次
- 分析攻击者的初始权限范围

#### Step 2: 追踪攻击路径
- 跟踪恶意数据的传播路径
- 识别跨越的组件和服务
- 记录权限变化和提升过程

#### Step 3: 确定突破的边界
- 对照6种信任边界类型
- 识别攻击前后的权限对比
- 确定突破的具体边界类型

#### Step 4: 评估影响范围
- 分析攻击者获得的新权限
- 评估对系统安全的整体影响
- 确定潜在的进一步攻击路径

### 3.2 分类决策标准

```
信任边界突破类型判断：
├── 攻击起点在数据平面？
│   ├── YES → 影响宿主机？ ────── YES → 数据平面到宿主机
│   └── YES → 访问控制平面资源？ ── YES → 数据平面到控制平面
├── 攻击起点在控制平面？
│   ├── YES → 影响其他控制平面组件？ ── YES → 控制平面组件间
│   └── YES → 向数据平面传播？ ──── YES → 控制平面到数据平面  
├── 跨命名空间访问？ ──────────── YES → 多租户隔离突破
└── 内部资源外部暴露？ ────────── YES → 外部到内部集群
```

---

## 4. 分析示例

### 4.1 CVE-2021-25741示例分析

#### 攻击场景
- **攻击起点**：Ingress资源的configuration-snippet注解
- **注入内容**：恶意nginx配置指令
- **攻击路径**：Ingress → nginx配置 → 文件系统访问
- **突破边界**：数据平面到控制平面

#### 分析过程
1. **起点确认**：攻击始于数据平面的Ingress资源
2. **路径追踪**：恶意配置被写入nginx配置文件，nginx执行后暴露服务账户令牌
3. **边界识别**：从数据平面的nginx容器访问到控制平面的服务账户令牌
4. **影响评估**：获得集群管理员权限，可控制整个集群

#### 分类结果
**数据平面到控制平面 (Data Plane to Control Plane)**

---

## 5. 质量控制

### 5.1 一致性检查
- 多名分析师独立分析同一案例
- 交叉验证分类结果
- 记录分歧和解决过程

### 5.2 验证标准
- 每个分类必须有明确的攻击路径支持
- 边界突破必须有具体的权限变化证据
- 影响范围评估必须基于实际攻击效果

### 5.3 边界情况处理
- **多重边界突破**：选择影响最大的主要边界
- **间接突破**：重点关注直接的边界跨越
- **权限模糊**：基于实际攻击效果进行分类

---

## 6. 注意事项

### ✅ 需要重点关注的指标
- 攻击前后的权限对比
- 跨越的具体架构边界
- 实际的安全影响程度

### ❌ 不应混淆的概念
- 技术手段 vs 信任边界突破
- 中间步骤 vs 最终边界突破
- 理论可能 vs 实际突破

### 🔧 特殊情况处理
- **链式攻击**：识别每个阶段的边界突破
- **权限累积**：关注最终达到的权限边界
- **防御绕过**：重点分析突破的信任假设