# RQ3-C 漏洞影响分析Codebook

## 1. 总体说明

### 1.1 分析目标
基于漏洞的最终安全后果分析Kubernetes资源注入漏洞的影响类型，采用多维度评估方法识别攻击效果和集群权限升级路径。

### 1.2 关键概念
- **最终安全后果**：漏洞被成功利用后的实际影响，而非中间步骤
- **主要影响**：造成最严重安全后果的影响类型
- **权限升级路径**：从初始利用到获得集群管理员权限的攻击路径

### 1.3 分析原则
- 基于**最终影响**而非中间效果进行分类
- 结合**CVSS向量**和**CWE分类**进行技术分析
- 考虑**K8s特定的权限模型**和**集群架构特征**

---

## 2. 漏洞影响分类框架

### 2.1 权限提升 (Privilege Escalation)

#### 定义
攻击者获得超出其原有权限范围的访问能力，包括容器突破、集群权限提升等

#### 子类别
- **容器突破** (Container Breakout)：从容器逃逸到宿主机
- **跨命名空间权限提升** (Cross-namespace Privilege Escalation)：突破命名空间隔离
- **K8s安全策略绕过** (K8s-security-policy Bypass)：绕过RBAC、网络策略等安全控制

#### 识别特征
- **CVSS向量**：包含Scope (S) 变化，Confidentiality/Integrity/Availability影响为High
- **CWE分类**：CWE-269 (Improper Privilege Management)、CWE-250 (Execution with Unnecessary Privileges)
- **技术特征**：
  - 获得ServiceAccount token访问集群API
  - 挂载宿主机敏感目录
  - 绕过Pod安全策略或网络策略
  - 执行特权容器或获得root权限

#### 典型案例
- CVE-2021-25741：通过Ingress注解注入访问ServiceAccount token，获得集群管理员权限
- CVE-2024-3154：通过Pod注解注入systemd属性实现容器逃逸

### 2.2 任意命令/代码执行 (Remote Code Execution)

#### 定义
攻击者能够在目标系统上执行任意命令或代码

#### 识别特征
- **CVSS向量**：Impact分数通常为High，特别是Integrity和Availability
- **CWE分类**：CWE-94 (Code Injection)、CWE-78 (OS Command Injection)
- **技术特征**：
  - 通过资源字段注入执行系统命令
  - 利用模板渲染执行恶意代码
  - 通过容器镜像或启动脚本执行代码

#### 典型案例
- CVE-2024-10220：通过GitRepo字段注入git命令参数执行任意命令
- CVE-2021-37914：通过Argo Workflows参数注入覆盖env字段执行命令

### 2.3 信息泄露 (Information Disclosure)

#### 定义
攻击者获得对敏感信息的未授权访问，包括配置信息、密钥、集群状态等

#### 识别特征
- **CVSS向量**：主要影响Confidentiality为Medium或High
- **CWE分类**：CWE-200 (Information Exposure)、CWE-522 (Insufficiently Protected Credentials)
- **技术特征**：
  - 访问其他命名空间的Secret或ConfigMap
  - 读取宿主机敏感文件
  - 获得集群配置或状态信息
  - 泄露API访问凭据

#### 典型案例
- CVE-2022-31036：通过符号链接读取服务器任意文件
- CVE-2024-43803：跨命名空间访问Secret资源

### 2.4 拒绝服务 (Denial of Service)

#### 定义
攻击者阻止合法用户正常使用系统资源或服务

#### 识别特征
- **CVSS向量**：主要影响Availability为Medium或High
- **CWE分类**：CWE-400 (Uncontrolled Resource Consumption)、CWE-770 (Allocation of Resources Without Limits)
- **技术特征**：
  - 消耗过量CPU、内存或存储资源
  - 阻塞关键系统进程
  - 破坏网络连接或服务可用性
  - 触发系统重启或崩溃

#### 典型案例
- CVE-2022-31030：通过ExecSync请求触发资源耗尽
- CVE-2021-32783：关闭Envoy代理导致服务不可用

### 2.5 跨站脚本攻击 (XSS)

#### 定义
攻击者在Web界面中注入恶意脚本，影响其他用户的浏览器会话

#### 识别特征
- **CVSS向量**：通常影响Confidentiality和Integrity为Medium
- **CWE分类**：CWE-79 (Cross-site Scripting)
- **技术特征**：
  - 在Web UI中显示未转义的用户输入
  - 通过资源字段注入JavaScript代码
  - 影响管理员或其他用户的Web会话

### 2.6 服务端请求伪造/跨站请求伪造 (SSRF/CSRF)

#### 定义
攻击者诱使服务器发起非预期的网络请求或执行非预期的操作

#### 识别特征
- **CVSS向量**：影响范围可能扩展到其他系统，Scope可能变化
- **CWE分类**：CWE-918 (SSRF)、CWE-352 (CSRF)
- **技术特征**：
  - 通过URL字段触发服务器访问内部资源
  - 探测内部网络服务
  - 绕过网络边界访问受限服务

#### 典型案例
- CVE-2022-29164：利用HTML artifact触发SSRF攻击

---

## 3. K8s集群权限升级分析

### 3.1 横向移动能力分析

#### 3.1.1 Pod间移动
**评估标准**：
- 能否访问同节点其他Pod
- 能否通过共享网络或存储访问其他Pod
- 能否利用Pod间通信机制

**技术指标**：
- 网络策略绕过能力
- 共享卷访问权限
- 进程间通信利用

#### 3.1.2 Namespace突破
**评估标准**：
- 能否跨越命名空间边界访问资源
- 能否绕过多租户隔离机制
- 能否访问其他租户的敏感数据

**技术指标**：
- 跨命名空间资源引用
- RBAC策略绕过
- 网络隔离突破

#### 3.1.3 节点访问
**评估标准**：
- 能否获得工作节点的访问权限
- 能否读写宿主机文件系统
- 能否影响节点级服务

**技术指标**：
- 容器逃逸能力
- hostPath挂载利用
- 节点资源访问权限

#### 3.1.4 控制平面访问
**评估标准**：
- 能否访问API Server
- 能否影响控制平面组件
- 能否获得集群级权限

**技术指标**：
- ServiceAccount token获取
- 控制平面组件漏洞利用
- 集群管理接口访问

### 3.2 K8s集群管理员权限升级分析

#### 3.2.1 cluster-admin权限获取
**评估标准**：
- 是否可直接获得cluster-admin角色
- 是否可间接获得等效权限
- 权限获取的复杂度和可靠性

**升级路径**：
- 直接ServiceAccount token泄露
- RBAC配置错误利用
- 特权容器权限扩展

#### 3.2.2 etcd访问权限
**评估标准**：
- 能否直接访问etcd数据库
- 能否通过API Server间接操作etcd
- 能否读取etcd中的敏感数据

**技术路径**：
- etcd客户端证书获取
- API Server权限滥用
- 备份文件访问

#### 3.2.3 kubelet权限利用
**评估标准**：
- 能否访问kubelet API
- 能否通过kubelet获得节点权限
- 能否利用kubelet特权操作

**利用方式**：
- kubelet端口访问
- 证书文件利用
- 容器运行时接口访问

#### 3.2.4 API Server权限
**评估标准**：
- 能否绕过RBAC获得API访问权限
- 能否利用API Server漏洞
- 能否获得API Server管理权限

**攻击路径**：
- 认证绕过漏洞
- 授权检查绕过
- API Server配置错误

---

## 4. 分析方法和决策标准

### 4.1 影响分类决策树
```
漏洞影响分析
├── 获得了超出原有的权限？
│   ├── YES → 权限提升
│   │   ├── 容器逃逸？ → Container Breakout
│   │   ├── 跨命名空间？ → Cross-namespace Privilege Escalation  
│   │   └── 绕过安全策略？ → K8s-security-policy Bypass
├── 能执行任意命令/代码？ → 任意命令/代码执行
├── 泄露了敏感信息？ → 信息泄露
├── 影响服务可用性？ → 拒绝服务
├── Web界面脚本注入？ → 跨站脚本攻击
└── 服务器端请求伪造？ → SSRF/CSRF
```

### 4.2 权限升级路径评估矩阵

| 升级目标 | 直接路径 | 间接路径 | 复杂度 | 成功率 |
|---------|----------|----------|--------|--------|
| cluster-admin | ServiceAccount token | RBAC绕过 | 低-高 | 高-低 |
| etcd访问 | 证书文件 | API Server权限 | 中-高 | 中-高 |
| kubelet权限 | API直接访问 | 容器逃逸 | 低-中 | 高-中 |
| API Server | 认证绕过 | 权限提升 | 高-中 | 低-中 |

### 4.3 综合风险评估
**评估维度**：
1. **直接影响严重程度**：基于CVSS分数和影响类型
2. **横向移动潜力**：评估攻击扩散能力
3. **权限升级可能性**：评估获得集群管理员权限的概率
4. **攻击复杂度**：评估利用难度和技术要求

---

## 5. 分析示例

### 5.1 CVE-2021-25741分析

**漏洞影响分析**：
```
主要效果：权限提升 (Container Breakout)
次要效果：信息泄露
分类依据：通过Ingress注解注入访问ServiceAccount token，获得集群管理员权限，CVSS向量显示Scope变化和高影响
```

**K8s集群权限升级分析**：
- **横向移动能力**：高 - 可跨命名空间访问资源
- **cluster-admin权限获取**：直接 - 通过ServiceAccount token
- **升级复杂度**：低 - 单一漏洞即可获得最高权限
- **成功率**：高 - 可靠的利用路径

### 5.2 CVE-2022-31036分析

**漏洞影响分析**：
```
主要效果：信息泄露
次要效果：无
分类依据：通过符号链接读取服务器任意文件，主要影响Confidentiality，CWE-200信息暴露
```

**K8s集群权限升级分析**：
- **横向移动能力**：中 - 限于单一组件文件访问
- **cluster-admin权限获取**：间接 - 需要组合其他漏洞
- **升级复杂度**：高 - 需要多步骤攻击链
- **成功率**：中 - 依赖具体环境配置

---

## 6. 质量控制

### 6.1 分析一致性要求
- 基于具体的技术证据进行分类
- 优先考虑最终安全后果而非中间步骤
- 结合CVSS向量和CWE分类验证判断

### 6.2 权限升级评估标准
- 评估实际的攻击路径可行性
- 考虑K8s特定的安全机制
- 分析攻击复杂度和成功概率

### 6.3 边界情况处理
- **多重影响**：按严重程度排序，选择主要影响
- **条件性影响**：基于典型部署场景评估
- **理论vs实际**：重点关注实际可利用的影响