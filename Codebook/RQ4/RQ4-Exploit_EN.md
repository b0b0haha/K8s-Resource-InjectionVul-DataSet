# RQ4 Vulnerability Exploitation Condition Analysis Codebook

## 1. General Description

### 1.1 Analysis Objectives
Analyze the trigger conditions of Kubernetes resource injection vulnerabilities from two dimensions: attack patterns and exploitation complexity, evaluating the difficulty of vulnerability exploitation and the technical requirements needed by attackers.

### 1.2 Key Concepts
- **Attack Pattern**: Malicious content utilization method based on injection mechanism characteristics
- **Exploitation Complexity**: Attack trigger difficulty assessment from resource operation and component interaction perspectives
- **Component**: Software module or service unit with clear functional boundaries and independent logical processing capabilities

### 1.3 Analysis Principles
- Analysis based on **specific attack processes** and **PoC details**
- Focus on **minimum attack requirements** rather than theoretically complex scenarios
- Consider trigger conditions in **actual deployment environments**

---

## 2. Attack Pattern Classification Framework

### 2.1 Static Configuration Injection

#### Definition
Attackers directly specify malicious values in configuration fields, which are used by the system as-is without conversion processing

#### Feature Identification
- **Direct Malicious Values**: Attack payloads directly written into resource fields
- **No Conversion Processing**: Field values are used directly by the system without complex conversion
- **Configuration-time Injection**: Malicious content included during resource creation or update
- **Immediate Effect**: Malicious configuration takes effect immediately or at next processing

#### Technical Characteristics
- Field value format consistent with final usage format
- Lack of input validation and filtering mechanisms
- Malicious content directly identifiable and understandable

#### Typical Cases
- **CVE-2021-25741**: Directly writing malicious nginx directives in nginx configuration annotations
- **CVE-2024-10220**: Directly specifying malicious repository paths in gitRepo.repository field
- **CVE-2021-25745**: Directly writing malicious nginx configuration statements in path field

#### Identification Criteria
- Attack payloads clearly visible in resource definitions
- Direct correspondence between field values and attack effects
- No complex processing or conversion required at runtime

### 2.2 Dynamic Parameter-based Generation Attack

#### Definition
User input appears harmless but is converted to malicious values through runtime processing, primarily manipulating data structures by breaking through expected processing contexts

#### Feature Identification
- **Apparently Harmless Input**: Initial input content appears to be normal parameters
- **Runtime Conversion**: Conversion through template rendering, command construction, expression evaluation, etc.
- **Context Breaking**: Utilizing processing mechanism characteristics to change expected behavior
- **Delayed Effect**: Malicious effects manifest after runtime processing

#### Technical Characteristics
- Involving template engines, parameter substitution, dynamic configuration generation
- Utilizing syntax features (such as JSON templates, shell expansion)
- Requiring understanding of system processing logic and context

#### Main Scenarios
- **Template Rendering Injection**: Utilizing variable substitution mechanisms of template engines
- **Command Construction Injection**: Influencing final commands through parameter concatenation
- **Expression Evaluation Injection**: Utilizing dynamic expression evaluation mechanisms
- **Configuration Merge Injection**: Overriding critical parameters through configuration merge processes

#### Typical Cases
- **CVE-2021-37914**: Dynamically modifying env fields at runtime through Argo Workflows' parameter override mechanism

#### Identification Criteria
- Initial input not directly corresponding to final attack effects
- System runtime processing required to produce malicious effects
- Involving complex data transformation or processing logic

---

## 3. Exploitation Complexity Analysis Framework

### 3.1 API Operation Complexity

#### 3.1.1 Resource API Count Analysis
**Definition**: Minimum number of Kubernetes API calls required to complete an attack

**Evaluation Criteria**:
- **Single API Call**: Only requires one CREATE/UPDATE operation
- **Multiple API Calls**: Requires coordination of multiple resource operations
- **Complex API Sequence**: Requires multiple API operations in specific order

**Analysis Method**:
1. Identify all API operations required for the attack
2. Determine minimum operation count requirements
3. Analyze dependency relationships between API operations

#### 3.1.2 Resource Category Count Analysis
**Definition**: Number of different Kubernetes resource types involved in the attack

**Evaluation Criteria**:
- **Single Resource Type**: Only involves one type of K8s resource
- **Multiple Resource Types**: Requires operating multiple different resources
- **Cross-resource Type Collaboration**: Multiple resources need to coordinate

**Typical Patterns**:
- Workload resources like Pod, Deployment, Service
- Configuration resources like ConfigMap, Secret
- Network resources like Ingress, Gateway
- Extension resources like CustomResource

### 3.2 Field Modification Complexity

#### 3.2.1 Number of Modified Resource Fields
**Definition**: Minimum number of fields that need to be modified to trigger the vulnerability

**Evaluation Dimensions**:
- **Required Fields**: Fields that must be modified to trigger the vulnerability
- **Optional Fields**: Fields that can enhance attack effects but are not essential
- **Coordinated Fields**: Field combinations that need to be modified simultaneously to take effect

#### 3.2.2 Field Relationship Analysis
**Analysis Dimensions**:
- **Independent Fields**: Can trigger vulnerability when modified alone
- **Dependent Fields**: Require coordination with other fields to take effect
- **Mutually Exclusive Fields**: Certain field combinations conflict with each other

#### 3.2.3 Injection Coordination Mechanism
**Coordination Patterns**:
- **Intra-resource Coordination**: Multiple fields within the same resource coordinate
- **Cross-resource Coordination**: Fields from different resources need to coordinate
- **Temporal Coordination**: Field modifications require specific timing order

### 3.3 Component Interaction Complexity

#### 3.3.1 Component Definition and Identification
**Component Definition**:
Independent software modules or service units in Kubernetes systems that undertake specific functional responsibilities, having:
- Clear functional boundaries and responsibilities
- Independent logical processing capabilities
- Interaction through clear interfaces

**Component Types**:
- **K8s Built-in Components**: API Server, etcd, kubelet, kube-proxy
- **Controller Components**: Deployment Controller, Service Controller, etc.
- **Third-party Controllers**: Ingress Controller, Operator, etc.
- **Application Components**: Specific application services and proxies

#### 3.3.2 Component Count Statistics Method
**Statistics Principles**:
- Only count components **directly participating** in vulnerability trigger process
- Exclude components with indirect influence or irrelevant components
- Count according to components through which attack data flows

**Identification Steps**:
1. **Trace Attack Process**: Complete path from resource creation to vulnerability trigger
2. **Identify Data Flow**: Propagation path of malicious data between components
3. **Determine Participating Components**: Components that actually process malicious data
4. **Count Component Numbers**: Total number of components after deduplication

#### 3.3.3 Component Dependency Relationship Analysis
**Dependency Relationship Types**:
- **Sequential Dependency**: Components need to process in specific order
- **Data Dependency**: Components need to pass specific data between each other
- **State Dependency**: Component state changes affect other components

**Analysis Dimensions**:
- **Call Chain**: Calling relationships and order between components
- **Data Transfer**: Flow method of malicious data between components
- **State Synchronization**: Synchronization mechanism of component state changes

---

## 4. Analysis Examples

### 4.1 CVE-2021-25741 Analysis

**Attack Pattern Analysis**:
- **Pattern Type**: Static Configuration Injection
- **Analysis Basis**: Directly writing malicious configuration directives in nginx configuration annotations without runtime conversion

**Exploitation Complexity Analysis**:
- **API Operation Complexity**: 1 API call (CREATE/UPDATE Ingress)
- **Resource Category Count**: 1 (Ingress resource)
- **Field Modification Count**: 1 field (configuration-snippet annotation)
- **Component Interaction Complexity**: 2 components
  - Component 1: Ingress Controller (processing Ingress resources)
  - Component 2: Nginx (executing configuration files)
- **Dependency Relationship**: Ingress Controller reads annotations → generates nginx configuration → Nginx loads configuration

### 4.2 CVE-2021-37914 Analysis

**Attack Pattern Analysis**:
- **Pattern Type**: Dynamic Parameter-based Generation Attack
- **Analysis Basis**: Through seemingly normal parameter input, overriding env fields at runtime through template processing mechanism

**Exploitation Complexity Analysis**:
- **API Operation Complexity**: 1 API call (submit workflow)
- **Resource Category Count**: 1 (Workflow resource)
- **Field Modification Count**: 1 field (runtime parameters)
- **Component Interaction Complexity**: 3 components
  - Component 1: Argo Workflows Controller (processing workflow)
  - Component 2: Parameter Processing Engine (dynamic parameter substitution)
  - Component 3: Container Runtime (executing final commands)
- **Dependency Relationship**: Parameter submission → template processing → field override → container execution

---

## 5. Quality Control

### 5.1 Analysis Consistency Requirements
- Analysis based on specific PoCs and attack processes
- Statistics based on minimum attack requirements rather than most complex scenarios
- Ensure accuracy and completeness of component identification

### 5.2 Complexity Evaluation Standards
- API operation count based on actual minimum requirements
- Field modification count only calculates required fields
- Component count based on directly participating components

### 5.3 Boundary Case Handling
- **Optional Attack Paths**: Choose the simplest attack path for analysis
- **Environment Differences**: Evaluation based on typical deployment environments
- **Permission Assumptions**: Analysis based on attacker's existing basic permissions 